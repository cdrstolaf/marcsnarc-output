<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CRH-test - MARC Records</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; line-height: 1.6; background: #fafafa; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 2em; font-weight: 300; }
        .header p { margin: 10px 0 0; opacity: 0.9; }
        
        /* Image Gallery */
        .image-gallery { display: flex; gap: 15px; overflow-x: auto; padding: 20px 0; margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .thumbnail-container { flex-shrink: 0; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .thumbnail-container:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .thumbnail { width: 200px; height: 300px; object-fit: cover; border-radius: 8px; border: 3px solid #e0e0e0; transition: border-color 0.2s ease; }
        .thumbnail-container:hover .thumbnail { border-color: #667eea; }
        .thumbnail-label { text-align: center; margin-top: 8px; font-size: 0.85em; color: #666; font-weight: 500; word-break: break-word; max-width: 200px; }
        .no-images { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90vw; max-height: 90vh; }
        .modal-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 15px; right: 20px; color: white; font-size: 30px; font-weight: bold; cursor: pointer; z-index: 1001; width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; transition: background 0.2s ease; }
        .modal-close:hover { background: rgba(255,0,0,0.7); }
        .modal-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 15px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; transition: background 0.2s ease; }
        .modal-nav:hover { background: rgba(0,0,0,0.8); }
        .modal-prev { left: 20px; }
        .modal-next { right: 20px; }
        .modal-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        
        /* MARC Records */
        .records-section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin: 30px 0 20px; }
        .marc-record { background: white; border: none; margin-bottom: 25px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .marc-record h3 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .confidence { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); padding: 6px 12px; border-radius: 20px; display: inline-block; margin-bottom: 15px; color: #2c5530; font-weight: 500; font-size: 0.9em; }
        .review-flag { background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border: none; color: #d63031; padding: 6px 12px; border-radius: 20px; margin-bottom: 15px; font-weight: 500; font-size: 0.9em; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #f0f0f0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; width: 100px; }
        .subfield-code { font-weight: bold; color: #667eea; background: #f8f9ff; padding: 2px 4px; border-radius: 3px; margin-right: 5px; }
        .no-records { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* External API Results */
        .api-results-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .api-results-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .api-summary { background: #f8f9ff; border: 1px solid #e0e6ff; border-radius: 6px; padding: 12px; margin-bottom: 20px; }
        .api-summary p { margin: 0; color: #333; font-size: 0.95em; }
        .api-source { margin-bottom: 20px; }
        .api-source h3 { color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .api-matches { background: #f8f9ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .api-match { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .api-match:last-child { margin-bottom: 0; }
        .match-title { font-weight: 600; color: #333; margin-bottom: 5px; }
        .match-author { color: #666; margin-bottom: 5px; }
        .match-details { font-size: 0.9em; color: #888; }
        .no-matches { text-align: center; padding: 20px; color: #999; font-style: italic; }
        .api-no-results { }
        .search-details { background: #f8f9fa; border-radius: 6px; padding: 15px; margin-top: 15px; }
        .search-details h4 { margin-top: 0; color: #495057; }
        .search-details ul { margin: 10px 0; padding-left: 20px; }
        .search-details li { margin-bottom: 5px; color: #6c757d; }
        .search-details em { color: #6c757d; }
        .authority-result { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 10px; }
        .authority-valid { background: #d4edda; color: #155724; }
        .authority-invalid { background: #f8d7da; color: #721c24; }
        
        /* JSON Tree View */
        .json-tree-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .json-tree-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .tree-container { border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #fafafa; max-height: 600px; overflow-y: auto; font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace; }
        .expand-all-btn, .collapse-all-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 10px; margin-bottom: 15px; font-size: 0.9em; transition: transform 0.2s ease; }
        .expand-all-btn:hover, .collapse-all-btn:hover { transform: translateY(-1px); }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.9em; background: white; border-radius: 10px; margin-top: 30px; }
        .footer a { color: #667eea; text-decoration: none; font-weight: 500; }
        .footer a:hover { text-decoration: underline; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .thumbnail { width: 150px; height: 225px; }
            .thumbnail-label { max-width: 150px; }
            .modal-nav { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CRH-test</h1>
        <p>üìö MARC Records generated by marcsnarc on 2025-12-23 09:46:57</p>
    </div>
    
    <div class='image-gallery'>

                <div class='thumbnail-container' onclick='openModal(0)'>
                    <img src='img_PXL_20251212_164209737.webp' alt='PXL_20251212_164209737.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164209737.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(1)'>
                    <img src='img_PXL_20251212_164253582.webp' alt='PXL_20251212_164253582.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164253582.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(2)'>
                    <img src='img_PXL_20251212_164339517.webp' alt='PXL_20251212_164339517.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164339517.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(3)'>
                    <img src='img_PXL_20251212_164450342.webp' alt='PXL_20251212_164450342.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164450342.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(4)'>
                    <img src='img_PXL_20251212_164650783.webp' alt='PXL_20251212_164650783.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164650783.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(5)'>
                    <img src='img_PXL_20251212_164821071.webp' alt='PXL_20251212_164821071.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164821071.jpg</div>
                </div>
                </div>

    
    <!-- Modal for image viewing -->
    <div id="imageModal" class="modal">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <button class="modal-nav modal-prev" onclick="changeImage(-1)">‚Äπ</button>
        <button class="modal-nav modal-next" onclick="changeImage(1)">‚Ä∫</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>
        <div class="modal-counter" id="modalCounter"></div>
    </div>
    
    <div class="records-section">
        <h2>üìã MARC Records</h2>
        <div class='marc-record'>
<h3>Record 1</h3>
<div class='confidence'>Confidence: 0.47</div>
<div class='review-flag'>‚ö†Ô∏è Review Required</div>
<table><tr><th>LDR</th><td>00000nam a200000 Ki 500</td></tr><tr><th>001</th><td>msn20251223154657</td></tr><tr><th>003</th><td>DLC</td></tr><tr><th>005</th><td>20251223154657.0</td></tr><tr><th>008</th><td>251223m19081966            o     00chi und d</td></tr><tr><th>040</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>DLC <span class="subfield-code">‚Ä°b</span>eng <span class="subfield-code">‚Ä°c</span>DLC <span class="subfield-code">‚Ä°e</span>rda </td></tr><tr><th>245</th><td><strong>00</strong> <span class="subfield-code">‚Ä°a</span>CRH-test </td></tr><tr><th>264</th><td><strong>_1</strong> <span class="subfield-code">‚Ä°c</span>1908 </td></tr><tr><th>300</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>6 items (various formats) </td></tr><tr><th>520</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection consists of 2 books, 4 other items. Items date from 1908 to 1966. </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection-level record for 6 items </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Provenance: Extracted from 6 images using marcsnarc </td></tr><tr><th>561</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Extracted from 6 images using marcsnarc </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Cultural Revolution </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Red Guards </td></tr><tr><th>999</th><td><strong>__</strong> <span class="subfield-code">‚Ä°i</span>Generated by marcsnarc on 2025-12-23 <span class="subfield-code">‚Ä°s</span>marcsnarc </td></tr></table></div>

    </div>
    
    <div class="api-results-section">
<h2>üåê External API Results</h2>
<div class="api-summary">
<p><strong>Search Summary:</strong> 2 item(s) searched across WorldCat, Library of Congress, and Alma catalogs</p>
</div>
<div class="api-no-results">
<div class="no-matches">External catalog searches were performed but no matches were found.</div>
<div class="search-details">
<p><strong>Search Status by Service:</strong></p>
<ul>
<li><strong>üìö WorldCat:</strong> Search attempted - likely failed due to server issues or no matches</li>
<li><strong>üèõÔ∏è Library of Congress:</strong> Authority validation performed</li>
<li><strong>üéì Alma Catalog:</strong> Local catalog searched</li>
</ul>
<p><em>Check the processing logs for detailed error messages.</em></p>
</div>
</div>
</div>

    
    
            <div class='json-tree-section'>
                <h2>üìä Analysis Data</h2>
                <div class='tree-container' id='analysis-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("analysis-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("analysis-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
            <div class='json-tree-section'>
                <h2>üìã Processing Metadata</h2>
                <div class='tree-container' id='metadata-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("metadata-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("metadata-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
    
    <div class="footer">
        Generated with <a href="https://github.com/anthropics/marcsnarc">marcsnarc</a> - AI-powered MARC cataloging
    </div>
    
    <script>
        // Global variables for modal and JSON data
        let currentImages = [];
        let currentImageIndex = 0;
        const analysisData = {"collection_analysis": {"item_count": 6, "formats": {"format_counts": {"archival collection": 1, "manuscript and printed leaflet": 1, "pamphlet": 2, "manuscript": 2}, "unique_formats": "{'pamphlet', 'archival collection', 'manuscript and printed leaflet', 'manuscript'}", "books": 2, "serials": 0, "ephemera": 0, "other": 4, "primary_format": "pamphlet"}, "creators": {"creator_counts": {"No. 27 Revolutionary Railroad Middle School": 1, "ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢": 1, "Huanxiang Commune (Ê¨¢‰πêÂÖ¨Á§æ) - Red Guards": 1, "‰∫∫Ê∞ëÊó•Êä•": 1, "Cannot be determined from image": 1}, "unique_creators": "{'‰∫∫Ê∞ëÊó•Êä•', 'ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢', 'Cannot be determined from image', 'No. 27 Revolutionary Railroad Middle School', 'Huanxiang Commune (Ê¨¢‰πêÂÖ¨Á§æ) - Red Guards'}", "items_with_creators": 5, "items_without_creators": 1, "dominant_creator": ["No. 27 Revolutionary Railroad Middle School", 1]}, "dates": {"date_range": [1908, 1966], "earliest_date": 1908, "latest_date": 1966, "date_span": 58, "items_with_dates": 4, "date_counts": {"1966": 2, "1958": 1, "1908": 1}}, "languages": {"language_counts": {"english, chinese (noted)": 1, "chi": 5}, "unique_languages": "{'english, chinese (noted)', 'chi'}", "primary_language": "chi", "multilingual": true}, "subjects": {"subject_counts": {"Chinese Cultural Revolution": 1, "Handbills": 1, "Leaflets": 1, "Guard groups": 1, "Red guard groups": 1, "Ephemera": 1, "Chinese politics": 1, "People's Daily": 1, "Liberation Daily": 1, "Cultural Revolution": 4, "Red Guards": 2, "Railroad schools": 1, "Political conflict": 1, "Revolutionary committees": 1, "Mao Zedong zhiyi": 1, "Political propaganda": 1, "Revolutionary movements": 1, "Anti-imperialism": 1, "Anti-feudalism": 1, "Censorship": 1, "Anti-revisionist movement": 1, "Banned books and songs": 1, "Communist China": 1, "Political campaigns": 1, "1958 Beijing": 1, "People's Liberation Army (PLA)": 1, "Revolutionary youth": 1, "Mao Zedong thought": 1, "Chinese Communist Party propaganda": 1, "Historical manuscript": 1, "Chinese literary or documentary text": 1, "Provincial or regional historical document": 1}, "unique_subjects": "{'Mao Zedong thought', 'Ephemera', 'Anti-revisionist movement', 'Banned books and songs', 'Leaflets', 'Chinese literary or documentary text', 'Anti-imperialism', 'Revolutionary committees', 'Handbills', 'Red Guards', 'Communist China', 'Mao Zedong zhiyi', 'Guard groups', 'Liberation Daily', \"People's Liberation Army (PLA)\", 'Provincial or regional historical document', 'Chinese Cultural Revolution', 'Railroad schools', 'Censorship', 'Red guard groups', 'Political propaganda', 'Revolutionary youth', 'Revolutionary movements', 'Cultural Revolution', 'Political campaigns', 'Chinese Communist Party propaganda', 'Historical manuscript', \"People's Daily\", 'Political conflict', 'Anti-feudalism', 'Chinese politics', '1958 Beijing'}", "items_with_subjects": 6, "common_subjects": [["Cultural Revolution", 4], ["Red Guards", 2], ["Chinese Cultural Revolution", 1], ["Handbills", 1], ["Leaflets", 1]], "subject_coherence": 3.03125}, "provenance": {"collection_provenance": "Extracted from 6 images using marcsnarc", "item_provenances": {}, "consistency_score": 1.0, "has_provenance": true}, "identifiers": {"items_with_isbn": 0, "items_with_issn": 0, "items_with_oclc": 0, "items_with_lccn": 0, "identifier_coverage": 0.0}, "physical_characteristics": {"extent_variety": 6, "dimension_variety": 4, "physical_coherence": 0.16666666666666663}, "format_diversity": 4, "creator_diversity": 5, "has_books_serials": true, "shared_provenance": true, "temporal_coherence": 0.2, "workflow_type": "collection_images_to_marc", "collection_name": "CRH-test", "processing_timestamp": "2025-12-23T09:46:57.271005", "total_records": 1, "approach": "collection"}, "batch_analysis": {"collection_name": "CRH-test", "total_images": 6, "successful_analyses": 6, "failed_analyses": 0, "individual_results": [{"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164209737.jpg", "extracted_data": {"title": "Archived Box 5 Chinese Cultural Revolution handbills, plus printed miscellany", "publication_date": "1960s-1980s", "normalized_date": {"normalized": null, "end_date": null, "circa": false, "uncertain": true, "original": "1960s-1980s"}, "format": "archival collection", "extent": "Archival box collection", "language": "english, chinese (noted)", "original_script_title": "Latin alphabet on visible descriptive label", "other_identifiers": "RVB collection, Arranged chronologically", "subjects": [{"heading": "Chinese Cultural Revolution", "type": "topical", "source": "claude_analysis"}, {"heading": "Handbills", "type": "topical", "source": "claude_analysis"}, {"heading": "Leaflets", "type": "topical", "source": "claude_analysis"}, {"heading": "Guard groups", "type": "topical", "source": "claude_analysis"}, {"heading": "Red guard groups", "type": "topical", "source": "claude_analysis"}, {"heading": "Ephemera", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese politics", "type": "topical", "source": "claude_analysis"}, {"heading": "People's Daily", "type": "topical", "source": "claude_analysis"}, {"heading": "Liberation Daily", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This appears to be an archival collection label describing the contents of Box 5", "source": "image_analysis"}, {"text": "Collection includes handbills from Red guard groups and other ephemera", "source": "image_analysis"}, {"text": "Materials described as 'very lengthy' and mostly in Chinese with some English translations", "source": "image_analysis"}, {"text": "References to newspapers including People's Daily and Liberation Daily", "source": "image_analysis"}, {"text": "A handwritten note on yellow paper is visible but partially legible, appears to reference 'Cultural Revolution handbills' and dates '1966-1973' and '4-20'", "source": "image_analysis"}, {"text": "The descriptive text mentions items were acquired in Beijing in the late 90s", "source": "image_analysis"}, {"text": "Mentions Chinese spokespeople as authors and Chinese poetry", "source": "image_analysis"}, {"text": "Collection arranged chronologically", "source": "image_analysis"}, {"text": "Contains leaflets representing various groups and ephemeral materials", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.15166666666666667, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.38558333333333333}, "overall_confidence": 0.38558333333333333, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "Archived Box 5 Chinese Cultural Revolution handbills, plus printed miscellany. RVB collection. Arranged chronologically. NA Handbills, leaflets, newspaper extras", "language": "English", "location": "descriptive label on white paper"}, {"text": "Cultural Revolution handbills [partially legible] 1966-1973 4-20", "language": "English", "location": "handwritten note on yellow paper"}, {"text": "The neatly items listed below were all acquired in Beijing in the late 90s. They are a mixture of original propaganda ephemera produced in Beijing in the Cultural Revolution period, plus a small amount of later material. Such as proposals to change local place names, from local red guard groups, and all of items to mobilize demonstrations. Some items are quite detailed accounts of meetings and disputes in the period of the Cultural Revolution. There are groups represented were long-lasting or only ephemeral... These leaflets represent a range of red guard and radical opinion in the Cultural Revolution. The ephemera here includes some Chinese poetry, newspaper clippings, and other groups materials such as People's Daily or Liberation Daily.", "language": "English", "location": "descriptive text on white paper"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 1}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164650783.jpg", "extracted_data": {"title": "Leaflet from No. 27 Revolutionary Railroad Middle School in conflict with the Railroad Elementary School", "subtitle": "Specially urgent report", "creator": {"name": "No. 27 Revolutionary Railroad Middle School", "type": "corporate", "source": "claude_analysis"}, "publication_date": "1966-67 (Cultural Revolution period)", "normalized_date": {"normalized": "1966", "end_date": null, "circa": true, "uncertain": false, "original": "1966-67 (Cultural Revolution period)"}, "format": "manuscript and printed leaflet", "extent": "2 items: 1 handwritten document, 1 printed leaflet with English translation", "dimensions": "Standard letter/A4 size approximately", "language": "chi", "original_script_title": "Simplified Chinese characters", "other_identifiers": "Archival reference number visible on yellow note: 1966-67, Railroad-Revolution handouts, Things were leafleted from red guards of the no 27 revolutionary railroad middle school", "subjects": [{"heading": "Cultural Revolution", "type": "topical", "source": "claude_analysis"}, {"heading": "Red Guards", "type": "topical", "source": "claude_analysis"}, {"heading": "Railroad schools", "type": "topical", "source": "claude_analysis"}, {"heading": "Political conflict", "type": "topical", "source": "claude_analysis"}, {"heading": "Revolutionary committees", "type": "topical", "source": "claude_analysis"}, {"heading": "Mao Zedong zhiyi", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Document appears to be a Cultural Revolution era leaflet with accompanying English translation", "source": "image_analysis"}, {"text": "Yellow sticky note indicates archival classification and date", "source": "image_analysis"}, {"text": "Handwritten document in blue ink on yellowed paper", "source": "image_analysis"}, {"text": "Translation describes conflict between No. 27 Railroad Middle School and Railroad Elementary School regarding revolutionary activities", "source": "image_analysis"}, {"text": "Content includes references to September 27, 1966 meeting and rhetorical questions about revolutionary commitment", "source": "image_analysis"}, {"text": "Document preserved in protective plastic sleeve", "source": "image_analysis"}, {"text": "Blue paperclip attached to items", "source": "image_analysis"}, {"text": "Physical condition shows age-related yellowing", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.15166666666666667, "format": 0.5850000000000001, "language": 0.5850000000000001, "overall": 0.48633333333333334}, "overall_confidence": 0.48633333333333334, "claude_factors": {"text_clarity": "medium", "completeness": "high", "language_certainty": "high"}, "original_text_regions": [{"text": "1966-67 / Railroad-Revolution handouts / Things were leafleted from red guards of the no 27 revolutionary railroad middle school", "language": "English", "location": "yellow sticky note (archival marking)"}, {"text": "Headline: ÁâπÊÄ•ÂëºÂêÅÔºÅÔºÅ (Teji huyu!!) [Trans: Specially urgent appeal] Published by: ‰∫å‰∏ÉÈìÅË∑ØÈù©ÂëΩÈÄ†ÂèçÊ¥æÊÄªÂ∑•ËøòÊØõÊ≥Ω‰∏ú(Á∫¢Âç´ÂÖµ) ze going to zhong Mao Zedong zhiyi", "language": "Chinese and English (translation)", "location": "printed translation sheet"}, {"text": "[Full handwritten Chinese text visible on main document - too extensive to fully transcribe but includes discussion of revolutionary activities, meetings, and conflicts between school factions]", "language": "Chinese (Simplified)", "location": "main handwritten document"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 2}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164821071.jpg", "extracted_data": {"title": "ÂΩªÂ∫ïÂèçÂ∏ù Áâ©Ë¥®ÂèçÂ∞ÅÂª∫ ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢", "creator": {"name": "ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢", "type": "corporate", "source": "claude_analysis", "romanization": "Ba Er Qi Geming Zaofan Tuan (827 Revolutionary Rebel Group)"}, "publisher": "ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢", "format": "pamphlet", "extent": "Single sheet, printed on both sides or folded format", "dimensions": "Approximately A4 or similar size", "language": "chi", "original_script_title": "Simplified Chinese characters", "other_identifiers": "Handwritten notation '15' visible on yellow note", "subjects": [{"heading": "Cultural Revolution", "type": "topical", "source": "claude_analysis"}, {"heading": "Political propaganda", "type": "topical", "source": "claude_analysis"}, {"heading": "Revolutionary movements", "type": "topical", "source": "claude_analysis"}, {"heading": "Anti-imperialism", "type": "topical", "source": "claude_analysis"}, {"heading": "Anti-feudalism", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Yellow sticky note attached with handwritten text in Chinese", "source": "image_analysis"}, {"text": "Document appears to be from the Chinese Cultural Revolution period (1966-1976)", "source": "image_analysis"}, {"text": "Contains dense political text in multiple columns", "source": "image_analysis"}, {"text": "Material shows signs of age and archival storage", "source": "image_analysis"}, {"text": "Text includes references to revolutionary ideology and political struggle", "source": "image_analysis"}, {"text": "Multiple entries with names and biographical information visible", "source": "image_analysis"}, {"text": "Format suggests this is a wall poster (Â§ßÂ≠óÊä•) or political bulletin", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.15166666666666667, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.4668333333333333}, "overall_confidence": 0.4668333333333333, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "ÂΩªÂ∫ïÂèçÂ∏ù Áâ©Ë¥®ÂèçÂ∞ÅÂª∫ ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢", "language": "Chinese (Simplified)", "location": "title"}, {"text": "ÊØõ‰∏ªÂ∏≠ Âë®ÊÄªÁêÜ", "language": "Chinese (Simplified)", "location": "body text, header area"}, {"text": "Handwritten note on yellow sticky: [partially legible Chinese characters] 15", "language": "Chinese (Simplified) handwriting", "location": "annotation"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 3}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164339517.jpg", "extracted_data": {"title": "Urgent appeal to ban some books and songs, from red guards in the 'Anti-revisionist Commune'", "creator": {"name": "Huanxiang Commune (Ê¨¢‰πêÂÖ¨Á§æ) - Red Guards", "type": "corporate", "source": "claude_analysis", "romanization": "Huanxiang Gongshe"}, "publisher": "Red Guards from 'Anti-revisionist Commune'", "publication_place": "Beijing suburbs (possibly near Guanyuan ÁÆ°Âõ≠)", "publication_date": "1958 or related to 1958 events", "normalized_date": {"normalized": "1958", "end_date": null, "circa": false, "uncertain": false, "original": "1958 or related to 1958 events"}, "format": "manuscript", "extent": "Multiple pages, handwritten document with typed English summary", "dimensions": "Standard letter/A4 size approximately", "language": "chi", "original_script_title": "Simplified Chinese characters", "other_identifiers": "42 (marked on yellow note); 67.66.37 (reference number on typed summary)", "subjects": [{"heading": "Cultural Revolution", "type": "topical", "source": "claude_analysis"}, {"heading": "Red Guards", "type": "topical", "source": "claude_analysis"}, {"heading": "Censorship", "type": "topical", "source": "claude_analysis"}, {"heading": "Anti-revisionist movement", "type": "topical", "source": "claude_analysis"}, {"heading": "Banned books and songs", "type": "topical", "source": "claude_analysis"}, {"heading": "Communist China", "type": "topical", "source": "claude_analysis"}, {"heading": "Political campaigns", "type": "topical", "source": "claude_analysis"}, {"heading": "1958 Beijing", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Document appears to be archival material with preservation sleeve", "source": "image_analysis"}, {"text": "Yellow sticky note contains handwritten cataloging information", "source": "image_analysis"}, {"text": "Typed English summary describes context: appeal to ban books and songs from feudal capitalist 'black' books", "source": "image_analysis"}, {"text": "References Ouyang Hai (Ê¨ßÈò≥Êµ∑) and Chairman Mao's studied study materials", "source": "image_analysis"}, {"text": "Mentions burning books and songs by Red Guards", "source": "image_analysis"}, {"text": "References former Huanxiangjing Commune (Ê¨¢‰πê‰∫ïÂÖ¨Á§æ) and village events from 1958", "source": "image_analysis"}, {"text": "Document discusses influence of former Beijing Party committee propaganda", "source": "image_analysis"}, {"text": "Mentions Green Leaf Pavilion (ÁªøÂè∂‰∫≠) at Minzu cultural center", "source": "image_analysis"}, {"text": "References a staple that should be removed from a plastic sleeve", "source": "image_analysis"}, {"text": "Handwritten Chinese text appears to be the original primary document", "source": "image_analysis"}, {"text": "Document relates to political censorship during Cultural Revolution period", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.45499999999999996, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.5275}, "overall_confidence": 0.5275, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "67.66.37 Urgent appeal to ban some books and songs, from red guards in the 'Anti-revisionist Commune'\nHeadline: ÂùöÂÜ≥Á†∏Á¢éÔºÅÔºÅÔºÅÔºÅjust haya!!!\n[Trans. Urgent appeal!!!]\nPublished by: Ê¨¢‰πêÂÖ¨Á§æ (ÂñúÂÖâÂ∑•Ê†°ÂÖ¨Á§æ), ÊñáÂåñÂÆ£ÂÖ®‰ΩìÈù©ÂëΩÈÄ†Âèç, Faxitu gongzhe Guanr Huangxiangjing", "language": "English with Chinese characters", "location": "typed summary sheet"}, {"text": "11.8.97\nCultural Revolution\nHandbills\nUrgent appeal to ban\nSome books + songs from\nRed Guards in 'Anti-revisionist Commune'\n42", "language": "English", "location": "yellow sticky note"}, {"text": "Á¥ßÊÄ•ÂëºÂêÅ!!!\n[Followed by extensive handwritten Chinese text discussing banned materials and Red Guard activities]", "language": "Chinese (Simplified)", "location": "handwritten manuscript page"}], "processing_notes": ["Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 4}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164450342.jpg", "extracted_data": {"title": "Èù©ÂëΩÈùíÂ∞ëÂπ¥Ë¶ÅÂêëËß£ÊîæÂÜõÂ≠¶‰π†", "subtitle": "‰∫∫Ê∞ëÊó•Êä•ÂÖ´Êúà‰∫åÂçÅÂÖ´Êó•Á§æËÆ∫", "creator": {"name": "‰∫∫Ê∞ëÊó•Êä•", "type": "corporate", "source": "claude_analysis", "romanization": "Renmin Ribao (People's Daily)"}, "publisher": "‰∫∫Ê∞ëÊó•Êä• (People's Daily)", "publication_place": "China (likely Beijing)", "publication_date": "1966-08-28", "normalized_date": {"normalized": "1966", "end_date": null, "circa": false, "uncertain": false, "original": "1966-08-28"}, "format": "pamphlet", "extent": "Single sheet printed matter", "dimensions": "Approximately standard newspaper/pamphlet size", "language": "chi", "original_script_title": "Simplified Chinese", "other_identifiers": "Archival notation: RI 1966/8.28; Call number visible in image: (9.5)", "subjects": [{"heading": "Cultural Revolution", "type": "topical", "source": "claude_analysis"}, {"heading": "People's Liberation Army (PLA)", "type": "topical", "source": "claude_analysis"}, {"heading": "Revolutionary youth", "type": "topical", "source": "claude_analysis"}, {"heading": "Mao Zedong thought", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese Communist Party propaganda", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This is a Cultural Revolution era document from August 28, 1966", "source": "image_analysis"}, {"text": "Features Mao quotations at top in red frame: 'Read Chairman Mao's books, listen to Chairman Mao's words, follow Chairman Mao's instructions, be Chairman Mao's good soldiers'", "source": "image_analysis"}, {"text": "Yellow sticky note on image indicates cataloging information: '1966 8.28 Cultural Revolution work-table People's Daily editorial from August 28'", "source": "image_analysis"}, {"text": "White card attached shows archival cataloging details with names of individuals mentioned", "source": "image_analysis"}, {"text": "Document appears to be preserved in protective plastic covering on wooden board", "source": "image_analysis"}, {"text": "Historical significance: Published during height of Cultural Revolution", "source": "image_analysis"}, {"text": "Editorial calling for revolutionary youth to learn from the Liberation Army", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.765, "creator": 0.675, "publication": 0.5850000000000001, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.642}, "overall_confidence": 0.642, "claude_factors": {"text_clarity": "high", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "ËØªÊØõ‰∏ªÂ∏≠ÁöÑ‰π¶ÔºåÂê¨ÊØõ‰∏ªÂ∏≠ÁöÑËØùÔºåÁÖßÊØõ‰∏ªÂ∏≠ÁöÑÊåáÁ§∫Âäû‰∫ãÔºåÂÅöÊØõ‰∏ªÂ∏≠ÁöÑÂ•ΩÊàòÂ£´", "language": "Chinese (Simplified)", "location": "header/quotation box"}, {"text": "Èù©ÂëΩÈùíÂ∞ëÂπ¥Ë¶ÅÂêëËß£ÊîæÂÜõÂ≠¶‰π†", "language": "Chinese (Simplified)", "location": "title"}, {"text": "Ôºà‰∫∫Ê∞ëÊó•Êä•ÂÖ´Êúà‰∫åÂçÅÂÖ´Êó•Á§æËÆ∫Ôºâ", "language": "Chinese (Simplified)", "location": "subtitle"}, {"text": "1966 8.28 Cultural Revolution work-table People's Daily editorial from August 28th (9.5)", "language": "English", "location": "yellow note (cataloging annotation)"}, {"text": "RI 1966/8.28 People's Daily editorial from August 28", "language": "English", "location": "white card (archival description)"}], "processing_notes": ["Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 5}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164253582.jpg", "extracted_data": {"title": "Y√ºchsh√ºng yezi yozichi (Y√ºchsh√ºng yezi yozidu)", "creator": {"name": "Cannot be determined from image", "type": null, "source": "claude_analysis"}, "publisher": "Cannot be determined from image", "publication_place": "Cannot be determined from image", "publication_date": "1908-23 (date range visible on label)", "normalized_date": {"normalized": "1908", "end_date": null, "circa": false, "uncertain": false, "original": "1908-23 (date range visible on label)"}, "format": "manuscript", "extent": "Single sheet manuscript", "dimensions": "Approximately standard letter size or slightly larger", "language": "chi", "original_script_title": "Traditional Chinese characters (vertical writing)", "other_identifiers": "8.23 (visible on yellow label)", "subjects": [{"heading": "Historical manuscript", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese literary or documentary text", "type": "topical", "source": "claude_analysis"}, {"heading": "Provincial or regional historical document", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Document appears to be a manuscript or archival material", "source": "image_analysis"}, {"text": "Accompanied by a yellow sticky note with romanized title and date range", "source": "image_analysis"}, {"text": "White descriptive label with English text providing context about the document", "source": "image_analysis"}, {"text": "Text written vertically in traditional Chinese script", "source": "image_analysis"}, {"text": "Document attached with paper clip", "source": "image_analysis"}, {"text": "Red markings/annotations visible on manuscript", "source": "image_analysis"}, {"text": "Preserved in protective plastic sleeve", "source": "image_analysis"}, {"text": "English label mentions 'provincial charters' and references to regional districts", "source": "image_analysis"}, {"text": "Label indicates this relates to 'Yunnan' and mentions 'Buddhists' and 'Mussulmans'", "source": "image_analysis"}, {"text": "Document appears to be part of an archival collection", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.45499999999999996, "format": 0.26, "language": 0.5850000000000001, "overall": 0.49824999999999997}, "overall_confidence": 0.49824999999999997, "claude_factors": {"text_clarity": "medium", "completeness": "low", "language_certainty": "high"}, "original_text_regions": [{"text": "Y√ºchsh√ºng yezi yozichi / Y√ºchsh√ºng yezi yozidu / 1908-23", "language": "English romanization with date", "location": "yellow sticky note"}, {"text": "[Vertical Chinese text - multiple columns visible but text too small to accurately transcribe individual characters]", "language": "Chinese (Traditional)", "location": "main manuscript body"}, {"text": "Partial visible text mentions 'Provincial charters', 'Yunnan', 'regional districts', 'Buddhists', 'Mussulmans', 'revolted areas', 'Y√ºchsh√ºng yezi yozidu'", "language": "English", "location": "white descriptive label"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Bibliographic information appears incomplete in image", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 6}], "collection_analysis": {"total_items": 6, "successful_extractions": 6, "common_characteristics": {"primary_language": "chi", "language_distribution": {"english, chinese (noted)": 1, "chi": 5}, "primary_format": "pamphlet", "format_distribution": {"archival collection": 1, "manuscript and printed leaflet": 1, "pamphlet": 2, "manuscript": 2}}, "quality_assessment": {"average_confidence": 0.5010833333333333, "high_confidence_items": 0, "low_confidence_items": 4, "confidence_range": [0.38558333333333333, 0.642]}, "recommendations": ["More than 30% of items have low confidence - consider manual review", "Multiple languages detected - verify language coding", "6 items contain CJK characters - verify romanization"]}, "batch_confidence": 0.5010833333333333, "processing_timestamp": "2025-12-23T09:46:57.072372"}, "individual_extractions": [{"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164209737.jpg", "extraction_confidence": 0.38558333333333333, "extracted_fields": ["title", "publication_date", "normalized_date", "format", "extent", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164650783.jpg", "extraction_confidence": 0.48633333333333334, "extracted_fields": ["title", "subtitle", "creator", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164821071.jpg", "extraction_confidence": 0.4668333333333333, "extracted_fields": ["title", "creator", "publisher", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164339517.jpg", "extraction_confidence": 0.5275, "extracted_fields": ["title", "creator", "publisher", "publication_place", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164450342.jpg", "extraction_confidence": 0.642, "extracted_fields": ["title", "subtitle", "creator", "publisher", "publication_place", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Cultural Revolution Handbills/PXL_20251212_164253582.jpg", "extraction_confidence": 0.49824999999999997, "extracted_fields": ["title", "creator", "publisher", "publication_place", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}], "external_api_results": [{"worldcat": [], "loc": [], "alma": [], "best_match": null}]};
        const metadataData = {"workflow_type": "collection_images_to_marc", "collection_name": "CRH-test", "processing_result": {"approach": "collection", "records_generated": 1, "review_required": true, "groupings": {"approach": "collection", "total_items": 6, "groups": [{"type": "collection", "items": ["Archived Box 5 Chinese Cultural Revolution handbills, plus printed miscellany", "Leaflet from No. 27 Revolutionary Railroad Middle School in conflict with the Railroad Elementary School", "ÂΩªÂ∫ïÂèçÂ∏ù Áâ©Ë¥®ÂèçÂ∞ÅÂª∫ ÂÖ´‰∫å‰∏ÉÈù©ÂëΩÈÄ†ÂèçÂõ¢", "Urgent appeal to ban some books and songs, from red guards in the 'Anti-revisionist Commune'", "Èù©ÂëΩÈùíÂ∞ëÂπ¥Ë¶ÅÂêëËß£ÊîæÂÜõÂ≠¶‰π†", "Y√ºchsh√ºng yezi yozichi (Y√ºchsh√ºng yezi yozidu)"], "record_type": "collection"}]}}, "collection_data": {"total_items": 6, "source_images": ["examples/Cultural Revolution Handbills/PXL_20251212_164209737.jpg", "examples/Cultural Revolution Handbills/PXL_20251212_164650783.jpg", "examples/Cultural Revolution Handbills/PXL_20251212_164821071.jpg", "examples/Cultural Revolution Handbills/PXL_20251212_164339517.jpg", "examples/Cultural Revolution Handbills/PXL_20251212_164450342.jpg", "examples/Cultural Revolution Handbills/PXL_20251212_164253582.jpg"], "provenance": "Extracted from 6 images using marcsnarc"}, "batch_analysis_summary": {"total_images": 6, "successful_analyses": 6, "batch_confidence": 0.5010833333333333}, "processing_timestamp": "2025-12-23T09:46:57.271015"};
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize images array from gallery
            const thumbnails = document.querySelectorAll('.thumbnail');
            currentImages = Array.from(thumbnails).map(img => ({
                src: img.src,
                alt: img.alt
            }));
            
            // Initialize JSON trees
            if (analysisData && Object.keys(analysisData).length > 0) {
                renderJsonTree('analysis-tree', analysisData);
            }
            if (metadataData && Object.keys(metadataData).length > 0) {
                renderJsonTree('metadata-tree', metadataData);
            }
        });
        
        // Modal functions
        function openModal(index) {
            currentImageIndex = index;
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const counter = document.getElementById('modalCounter');
            
            if (currentImages[index]) {
                modalImage.src = currentImages[index].src;
                modalImage.alt = currentImages[index].alt;
                counter.textContent = `${index + 1} of ${currentImages.length}`;
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + currentImages.length) % currentImages.length;
            openModal(currentImageIndex);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') closeModal();
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
            }
        });
        
        // Close modal on background click
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // JSON Tree rendering functions
        function renderJsonTree(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container || !data) return;
            
            container.innerHTML = '';
            const tree = createTreeElement(data, '', 0);
            container.appendChild(tree);
        }
        
        function createTreeElement(value, key, level) {
            const wrapper = document.createElement('div');
            wrapper.style.marginLeft = `${level * 20}px`;
            wrapper.style.marginBottom = '3px';
            
            if (value && typeof value === 'object' && !Array.isArray(value)) {
                // Object
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                Object.entries(value).forEach(([childKey, childValue]) => {
                    children.appendChild(createTreeElement(childValue, childKey, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìÇ ${key} {${Object.keys(value).length}}</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else if (Array.isArray(value)) {
                // Array
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                value.forEach((item, index) => {
                    children.appendChild(createTreeElement(item, `[${index}]`, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìñ ${key} [${value.length}]</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else {
                // Primitive value
                const element = document.createElement('div');
                const valueStr = value === null ? 'null' : String(value);
                const valueType = typeof value;
                let color = '#4a5568';
                let icon = 'üìÑ';
                
                if (valueType === 'string') { color = '#38a169'; icon = 'üìù'; }
                else if (valueType === 'number') { color = '#d69e2e'; icon = 'üî¢'; }
                else if (valueType === 'boolean') { color = '#9f7aea'; icon = '‚úÖ'; }
                else if (value === null) { color = '#a0aec0'; icon = '‚ùå'; }
                
                element.innerHTML = `<span style="color: #2d3748; font-weight: 600;">${icon} ${key}:</span> <span style="color: ${color};">${valueType === 'string' ? '"' + valueStr + '"' : valueStr}</span>`;
                wrapper.appendChild(element);
            }
            
            return wrapper;
        }
        
        function expandAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñ∂')) {
                    span.parentElement.click();
                }
            });
        }
        
        function collapseAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñº')) {
                    span.parentElement.click();
                }
            });
        }
    </script>
</body>
</html>