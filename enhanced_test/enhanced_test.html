<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>enhanced_test - MARC Records</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; line-height: 1.6; background: #fafafa; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 2em; font-weight: 300; }
        .header p { margin: 10px 0 0; opacity: 0.9; }
        
        /* Image Gallery */
        .image-gallery { display: flex; gap: 15px; overflow-x: auto; padding: 20px 0; margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .thumbnail-container { flex-shrink: 0; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .thumbnail-container:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .thumbnail { width: 200px; height: 300px; object-fit: cover; border-radius: 8px; border: 3px solid #e0e0e0; transition: border-color 0.2s ease; }
        .thumbnail-container:hover .thumbnail { border-color: #667eea; }
        .thumbnail-label { text-align: center; margin-top: 8px; font-size: 0.85em; color: #666; font-weight: 500; word-break: break-word; max-width: 200px; }
        .no-images { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90vw; max-height: 90vh; }
        .modal-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 15px; right: 20px; color: white; font-size: 30px; font-weight: bold; cursor: pointer; z-index: 1001; width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; transition: background 0.2s ease; }
        .modal-close:hover { background: rgba(255,0,0,0.7); }
        .modal-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 15px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; transition: background 0.2s ease; }
        .modal-nav:hover { background: rgba(0,0,0,0.8); }
        .modal-prev { left: 20px; }
        .modal-next { right: 20px; }
        .modal-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        
        /* MARC Records */
        .records-section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin: 30px 0 20px; }
        .marc-record { background: white; border: none; margin-bottom: 25px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .marc-record h3 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .confidence { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); padding: 6px 12px; border-radius: 20px; display: inline-block; margin-bottom: 15px; color: #2c5530; font-weight: 500; font-size: 0.9em; }
        .review-flag { background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border: none; color: #d63031; padding: 6px 12px; border-radius: 20px; margin-bottom: 15px; font-weight: 500; font-size: 0.9em; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #f0f0f0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; width: 100px; }
        .subfield-code { font-weight: bold; color: #667eea; background: #f8f9ff; padding: 2px 4px; border-radius: 3px; margin-right: 5px; }
        .no-records { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* External API Results */
        .api-results-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .api-results-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .api-summary { background: #f8f9ff; border: 1px solid #e0e6ff; border-radius: 6px; padding: 12px; margin-bottom: 20px; }
        .api-summary p { margin: 0; color: #333; font-size: 0.95em; }
        .api-source { margin-bottom: 20px; }
        .api-source h3 { color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .api-matches { background: #f8f9ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .api-match { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .api-match:last-child { margin-bottom: 0; }
        .match-title { font-weight: 600; color: #333; margin-bottom: 5px; }
        .match-author { color: #666; margin-bottom: 5px; }
        .match-details { font-size: 0.9em; color: #888; }
        .no-matches { text-align: center; padding: 20px; color: #999; font-style: italic; }
        .api-no-results { }
        .search-details { background: #f8f9fa; border-radius: 6px; padding: 15px; margin-top: 15px; }
        .search-details h4 { margin-top: 0; color: #495057; }
        .search-details ul { margin: 10px 0; padding-left: 20px; }
        .search-details li { margin-bottom: 5px; color: #6c757d; }
        .search-details em { color: #6c757d; }
        .authority-result { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 10px; }
        .authority-valid { background: #d4edda; color: #155724; }
        .authority-invalid { background: #f8d7da; color: #721c24; }
        
        /* JSON Tree View */
        .json-tree-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .json-tree-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .tree-container { border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #fafafa; max-height: 600px; overflow-y: auto; font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace; }
        .expand-all-btn, .collapse-all-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 10px; margin-bottom: 15px; font-size: 0.9em; transition: transform 0.2s ease; }
        .expand-all-btn:hover, .collapse-all-btn:hover { transform: translateY(-1px); }
        
        /* Text Analysis Section */
        .text-analysis-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .text-analysis-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .analysis-summary { background: #f8f9ff; border: 1px solid #e0e6ff; border-radius: 6px; padding: 12px; margin-bottom: 20px; }
        .analysis-overview { margin-bottom: 25px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0; }
        .stat-item { text-align: center; padding: 15px; background: linear-gradient(135deg, #f8f9ff 0%, #e6f3ff 100%); border-radius: 8px; border: 1px solid #e0e6ff; }
        .stat-number { font-size: 1.8em; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .stat-label { font-size: 0.9em; color: #666; font-weight: 500; }
        .item-analysis { background: #fdfdfd; border: 1px solid #e5e5e5; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .analysis-tabs { display: flex; border-bottom: 2px solid #f0f0f0; margin-bottom: 15px; }
        .tab-btn { background: none; border: none; padding: 10px 20px; cursor: pointer; font-weight: 500; color: #666; border-bottom: 2px solid transparent; transition: all 0.2s ease; }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-btn:hover { background: #f8f9ff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .text-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .text-column h5 { margin-top: 0; color: #333; font-size: 1em; }
        .text-content { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 12px; max-height: 300px; overflow-y: auto; font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace; font-size: 0.85em; line-height: 1.4; }
        .original-text { background: #fff9f0; border-color: #fed7aa; }
        .filtered-text { background: #f0f9ff; border-color: #bae6fd; }
        .text-stats { margin-top: 8px; color: #666; font-size: 0.8em; }
        .bibliographic-notes { margin: 15px 0; }
        .bib-note { background: white; border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px; margin-bottom: 10px; }
        .condition-note { border-left: 4px solid #f59e0b; background: #fef3c7; }
        .general-note { border-left: 4px solid #10b981; background: #d1fae5; }
        .note-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .note-type { background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.75em; font-weight: bold; }
        .note-score { font-size: 0.8em; color: #666; }
        .note-text { font-size: 0.9em; line-height: 1.4; }
        .line-analysis { margin: 15px 0; }
        .line-category { margin-bottom: 20px; }
        .line-category h6 { margin-bottom: 10px; color: #333; font-size: 0.95em; }
        .line-category.bibliographic { border-left: 4px solid #10b981; padding-left: 15px; }
        .line-category.general { border-left: 4px solid #3b82f6; padding-left: 15px; }
        .line-item { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; padding: 10px; margin-bottom: 8px; }
        .line-content { font-size: 0.9em; margin-bottom: 5px; }
        .line-meta { font-size: 0.75em; color: #666; }
        .more-lines { font-style: italic; color: #888; margin-top: 10px; }
        .no-analysis, .no-notes { text-align: center; padding: 30px; color: #999; font-style: italic; background: #f9f9f9; border-radius: 6px; }
        .collection-insights { margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; border: 1px solid #0ea5e9; }
        .collection-insights h4 { margin-top: 0; color: #0c4a6e; }
        .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .insight-item { background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .insight-item h5 { margin-top: 0; color: #333; font-size: 1em; }
        .insight-item ul { margin: 10px 0; padding-left: 20px; }
        .insight-item li { margin-bottom: 5px; color: #555; }
        .insight-item p { margin: 5px 0; color: #555; }
        .analysis-footer { margin-top: 25px; padding: 15px; background: #f8f9ff; border-radius: 6px; border: 1px solid #e0e6ff; }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.9em; background: white; border-radius: 10px; margin-top: 30px; }
        .footer a { color: #667eea; text-decoration: none; font-weight: 500; }
        .footer a:hover { text-decoration: underline; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .thumbnail { width: 150px; height: 225px; }
            .thumbnail-label { max-width: 150px; }
            .modal-nav { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>enhanced_test</h1>
        <p>üìö MARC Records generated by marcsnarc on 2025-12-23 16:44:33</p>
    </div>
    
    <div class='image-gallery'>

                <div class='thumbnail-container' onclick='openModal(0)'>
                    <img src='img_PXL_20251212_164253582.webp' alt='PXL_20251212_164253582.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164253582.jpg</div>
                </div>
                </div>

    
    <!-- Modal for image viewing -->
    <div id="imageModal" class="modal">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <button class="modal-nav modal-prev" onclick="changeImage(-1)">‚Äπ</button>
        <button class="modal-nav modal-next" onclick="changeImage(1)">‚Ä∫</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>
        <div class="modal-counter" id="modalCounter"></div>
    </div>
    
    <div class="records-section">
        <h2>üìã MARC Records</h2>
        <div class='marc-record'>
<h3>Record 1</h3>
<div class='confidence'>Confidence: 0.42</div>
<div class='review-flag'>‚ö†Ô∏è Review Required</div>
<table><tr><th>LDR</th><td>00000nam a200000 Ki 500</td></tr><tr><th>001</th><td>msn20251223224431</td></tr><tr><th>003</th><td>DLC</td></tr><tr><th>005</th><td>20251223224431.0</td></tr><tr><th>008</th><td>251223s1966                o     00und und d</td></tr><tr><th>040</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>DLC <span class="subfield-code">‚Ä°b</span>eng <span class="subfield-code">‚Ä°c</span>DLC <span class="subfield-code">‚Ä°e</span>rda </td></tr><tr><th>245</th><td><strong>00</strong> <span class="subfield-code">‚Ä°a</span>#1.1966.8.23 A proposal to change the name of Beijing's Fengtai district to Fengshou district, from the </td></tr><tr><th>264</th><td><strong>_1</strong> <span class="subfield-code">‚Ä°c</span>1966 </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Processed with Google Vision API using features: TEXT_DETECTION, DOCUMENT_TEXT_DETECTION, LABEL_DETECTION </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Processed with Google Vision API using features: TEXT_DETECTION, DOCUMENT_TEXT_DETECTION, LABEL_DETECTION </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Wood engravings </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Cutout animation films </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Paper Product </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Southern brown bandicoot </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Hardwood industry </td></tr><tr><th>999</th><td><strong>__</strong> <span class="subfield-code">‚Ä°i</span>Generated by marcsnarc on 2025-12-23 <span class="subfield-code">‚Ä°s</span>marcsnarc </td></tr></table></div>

    </div>
    
    <div class="api-results-section">
<h2>üåê External API Results</h2>
<div class="api-summary">
<p><strong>Search Summary:</strong> 1 item(s) searched across WorldCat, Library of Congress, and Alma catalogs</p>
</div>
<div class="api-source"><h3>Catalog Search Results</h3>
<div class="api-source">
<h3>üèõÔ∏è Library of Congress Authority Validation</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">subject_authority: Wood</div>
<span class="authority-result authority-valid">‚úÖ Valid</span>
<div class="match-details">Authorized form: Wood engravings</div>
</div>
<div class="api-match">
<div class="match-title">subject_authority: Paper</div>
<span class="authority-result authority-valid">‚úÖ Valid</span>
<div class="match-details">Authorized form: Cutout animation films</div>
</div>
<div class="api-match">
<div class="match-title">subject_authority: Paper Product</div>
<span class="authority-result authority-invalid">‚ùå Not found</span>
</div>
</div>
</div>
</div>
</div>

    
    
    <div class="text-analysis-section">
        <h2>üìù Text Analysis & Bibliographic Notes</h2>
        <div class="analysis-summary">
            <p>This section shows the intelligent text filtering and bibliographic content extraction performed by the analysis engine.</p>
        </div>
        
        <div class="no-analysis">
            <p>No detailed text analysis data available for this collection.</p>
            <p>Text analysis is available when using Google Vision API with enhanced content filtering.</p>
        </div>
    </div>
            
    
    
            <div class='json-tree-section'>
                <h2>üìã Processing Metadata</h2>
                <div class='tree-container' id='metadata-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("metadata-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("metadata-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
    
    <div class="footer">
        Generated with <a href="https://github.com/anthropics/marcsnarc">marcsnarc</a> - AI-powered MARC cataloging
    </div>
    
    <script>
        // Global variables for modal and JSON data
        let currentImages = [];
        let currentImageIndex = 0;
        const analysisData = {};
        const metadataData = {"workflow_type": "single_image_to_marc", "source_image": "examples/Cultural Revolution Handbills/PXL_20251212_164253582.jpg", "extracted_data": {"title": "#1.1966.8.23 A proposal to change the name of Beijing's Fengtai district to Fengshou district, from the", "creator": {}, "publication_date": "1966", "language": "und", "subjects": [{"heading": "Wood", "type": "topical", "source": "google_vision_labels", "confidence": 0.96674967}, {"heading": "Paper", "type": "topical", "source": "google_vision_labels", "confidence": 0.94814396}, {"heading": "Paper Product", "type": "topical", "source": "google_vision_labels", "confidence": 0.9251129}, {"heading": "Brown", "type": "topical", "source": "google_vision_labels", "confidence": 0.91419834}, {"heading": "Hardwood", "type": "topical", "source": "google_vision_labels", "confidence": 0.75882876}], "format": "text", "isbn": "", "raw_text": "1966.8.25\nCultural Revolution\nhandbills\nA proposal to change the\nnome of Beijing's Fender\ndistrict to Fengshion district\n#1.1966.8.23 A proposal to change the name of Beijing's Fengtai district to Fengshou district, from the\nred guards in a financial/tax office.\nHeadline:Èù©ÂëΩÂÄ°ËÆÆ‰π¶ Geming changyi shu\n[Trans: A revolutionary proposal]\nPublished by:Âåó‰∫¨Â∏Ç‰∏∞Êî∂Âå∫Á∫¢ÊóóË¥¢Á®éÊâÄÂÖ®‰ΩìÈù©ÂëΩÂêåÂøó Beijingshi fengshouqu hongqi caishuisuo\nquanti geming tongzhi\nNotes: Red guards from Fengtai district on the south side of Beijing propose changing the name of the\ndistrict to \"Fengshou district\" . The old name derives from feudal times when this area was a\npleasure resort for the nobility, and it was built with a lot of peasant labor. \"Fengshou\" means\n'plentiful harvest' and would be a more fitting name. In addition, they propose changing the name of\nFengtai zhen [Fengtai town] to Fengshou zhen, and the name of the main street to Hongqi dajie\nÁ∫¢ÊóóÂ§ßË°ó(Red Flag avenue).\nCondition: Good. Mimeographed and typeset on two one-sided sheets of paper ca. 10\"H x 7 '/2\" W. Top\nedges have been folded. Footprint smudge on bottom edge of p 1. Underlining in red pencil. Placed in a\nprotective plastic sleeve.\nÂÖ®‰ΩìÁ∫¢Âç´ÂÖµÂèä‰∏ÄÂàáÂëΩÁæ§‰ºóÂÄë:\nÂú®Êó†‰∫ßÈò∂Á∫ßÊñáÂåñÂ§ßÈù©ÂëΩ‰∏≠,ÊàëÂÄëÂåó‰∫¨Â∏Ç‰∏∞Êî∂Âå∫Á∫¢ÊóóË≤°Á®ÖÊâÄ(Âéü‰∏∞\nÂè∞Âå∫Âπ≥Âè∞Á•ùÂä°ÊâÄ)ÂÖ®‰ΩìÈù©ÂëΩÁæ§‰ºóÂêëÂÖ®‰ΩìÂπøÂ§ßÁæ§‰ºóÊèêÂá∫Èù©ÂëΩÁöÑÂÄ°Ë≠∞„ÄÇ\nÊàëÂÄëÂÄ°Ë≠∞:‰∏∞Âè∞Âå∫Êîπ‰∏∫Êî∂Âå∫,Âπ≥Âè∞ÈïáÊîπ‰∏∫‰∏∞Êî∂,Ê≠£Èò≥Â§ßË°óÊîπ\n‰∏∫Á∫¢ÊóóÂ§ßË°ó„ÄÇ\n‰∏∞Âè∞ÂêçÂ≠óÁöÑÊù•ÂéÜÊòØÂú®Â∞ÅÂª∫Á§æ‰ºöÊó∂Êúü,Áµ±Ê≤ªÈò∂Á¥öÂÆòËÄÅÁà∑‰ª¨‰∏∫‰∫ÜÈÅäÁé©\n‰∫´‰πê‰πãÁî®,Âú®Âπ≥Âè∞ÂíåËä±ÁßçËçâ,Âä®Áî®Â§ßÈáèÂä≥Â∑•Ê∞ë,‰øÆÂª∫ÂæàÂ§ö‰∫≠Âè∞Ê†°Èñ£\n‰ª•‰æøÂíåÂçóËãëÁöÑÁöáÂ∏ùÂä®Êàê‰∏ÄÁâá,‰æõÈÇ£Áè≠ÂéãÂú®‰∫∫Ê∞ëÂ§¥‰∏äÁöÑËÄÅÁà∑‰ª¨ÂÅöÂ®ÅÂÅöÁ¶è\nÈÅäÁé©‰∫´‰πê,ÊâÄ‰ª•ÂëΩÂêç‰∏∫Âπ≥Âè∞„ÄÇÁèæÂú®ÊàëÂÄëËß£Êîæ‰∫Ü,‰∫∫Ê∞ëÂΩì‰∫ÜÂÆ∂ÂÅö‰∫Ü‰∏ª,\nÂπøÂ§ßÁæ§‰ºóË¶ÅÂÅöÊóß‰∏ñÁïåÁöÑÊâπÂà§ËÄÖ,‰Ω†Êñ∞‰∏ñÁïåÁöÑÂª∫Ë®≠ËÄÖÂíå‰øùÂç´ËÄÖ,Ë¶Å\nÂùöÂÜ≥Ê∂àÁÅ≠Â∞ÅÂª∫Á§æ‰ºöÈÅóÁïô‰∏ãÊù•ÁöÑ‰∏ÄÂàáÊÆò‰Ωô,Ë¶ÅÂùöÊ±∫‰∏çÂáÜÂ∏¶ÊúâÂ∞ÅÂª∫ÊÄßË¥®ÁöÑ\nÂêçÂ≠óÁπºÁ∫å‰∏ãÂéª‰∫Ü„ÄÇ\n,Êàë‰ª¨ÂêëÂπøÂ§ßÂëΩÁæ§‰ºóÂèëÂá∫ÂëΩË≠∑„ÄÇÂá°ÊòØÂú∞Âêç„ÄÅË°óÂêç„ÄÅËÉ°ÂêåÂêç„ÄÅ\nÂïÜÂ∫óÂêçÂ≠ó,Âè™ÊúâÊòØÂ∏¶ÊúâÂ∞ÅÂª∫ÊÄßË¥®ÁöÑ,‰∏çÁ¨¶ÂêàÂΩì‰ª£Êó†‰∫ßÈò∂Á∫ßÈù©ÂëΩÂΩ¢ÂäøÁöÑ„ÄÇ\nÂÄ°Ë≠∞‰Ω†ÂÄë‰∏ÄÂæãÊõ¥Êèõ;\n2 Ëá™ÁèæÂú®Ëµ∑Êàë‰ª¨‰∏∞Âè∞Á®éÂä°ÊâÄÊîπÁî®‰∏∞Êî∂Âå∫Á¥ÖÊóóË≤°Á®ÖÊâÄ,Âá°‰∏éÊàëÊâÄÊúâ\nËÅîÁ≥ªÁöÑÂçï‰Ωç,ÈÉΩË¶Å‰ΩøÁî®ÂêçÂ≠ó„ÄÇ\nÂ∏åÊúõÂÖ®‰ΩìÁ∫¢Âç´ÂÖµ,ÂπøÂ§ßÈù©ÂëΩÁæ§‰ºóÂ§ßÂäõÁßØÊûÅÊîØÊåÅÊàëÂÄëÁöÑÈù©ÂëΩÂÄ°Ë≠∞!\n~1~", "notes": [{"text": "Processed with Google Vision API using features: TEXT_DETECTION, DOCUMENT_TEXT_DETECTION, LABEL_DETECTION", "source": "google_vision"}, {"text": "Processed with Google Vision API using features: TEXT_DETECTION, DOCUMENT_TEXT_DETECTION, LABEL_DETECTION", "source": "image_analysis"}], "extraction_source": "google_vision", "title_source": "damaged", "creator_source": "damaged", "publication_source": "google_vision", "image_source": "examples/Cultural Revolution Handbills/PXL_20251212_164253582.jpg", "extraction_confidence": 0.6953698690909093, "review_required": true}, "marc_generation": {"confidence_score": 0.4166666666666667, "review_required": true, "validation_issues": []}, "processing_timestamp": "2025-12-23T16:44:33.135055"};
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize images array from gallery
            const thumbnails = document.querySelectorAll('.thumbnail');
            currentImages = Array.from(thumbnails).map(img => ({
                src: img.src,
                alt: img.alt
            }));
            
            // Initialize JSON trees
            if (analysisData && Object.keys(analysisData).length > 0) {
                renderJsonTree('analysis-tree', analysisData);
            }
            if (metadataData && Object.keys(metadataData).length > 0) {
                renderJsonTree('metadata-tree', metadataData);
            }
        });
        
        // Modal functions
        function openModal(index) {
            currentImageIndex = index;
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const counter = document.getElementById('modalCounter');
            
            if (currentImages[index]) {
                modalImage.src = currentImages[index].src;
                modalImage.alt = currentImages[index].alt;
                counter.textContent = `${index + 1} of ${currentImages.length}`;
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + currentImages.length) % currentImages.length;
            openModal(currentImageIndex);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') closeModal();
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
            }
        });
        
        // Close modal on background click
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // JSON Tree rendering functions
        function renderJsonTree(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container || !data) return;
            
            container.innerHTML = '';
            const tree = createTreeElement(data, '', 0);
            container.appendChild(tree);
        }
        
        function createTreeElement(value, key, level) {
            const wrapper = document.createElement('div');
            wrapper.style.marginLeft = `${level * 20}px`;
            wrapper.style.marginBottom = '3px';
            
            if (value && typeof value === 'object' && !Array.isArray(value)) {
                // Object
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                Object.entries(value).forEach(([childKey, childValue]) => {
                    children.appendChild(createTreeElement(childValue, childKey, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìÇ ${key} {${Object.keys(value).length}}</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else if (Array.isArray(value)) {
                // Array
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                value.forEach((item, index) => {
                    children.appendChild(createTreeElement(item, `[${index}]`, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìñ ${key} [${value.length}]</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else {
                // Primitive value
                const element = document.createElement('div');
                const valueStr = value === null ? 'null' : String(value);
                const valueType = typeof value;
                let color = '#4a5568';
                let icon = 'üìÑ';
                
                if (valueType === 'string') { color = '#38a169'; icon = 'üìù'; }
                else if (valueType === 'number') { color = '#d69e2e'; icon = 'üî¢'; }
                else if (valueType === 'boolean') { color = '#9f7aea'; icon = '‚úÖ'; }
                else if (value === null) { color = '#a0aec0'; icon = '‚ùå'; }
                
                element.innerHTML = `<span style="color: #2d3748; font-weight: 600;">${icon} ${key}:</span> <span style="color: ${color};">${valueType === 'string' ? '"' + valueStr + '"' : valueStr}</span>`;
                wrapper.appendChild(element);
            }
            
            return wrapper;
        }
        
        function expandAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñ∂')) {
                    span.parentElement.click();
                }
            });
        }
        
        function collapseAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñº')) {
                    span.parentElement.click();
                }
            });
        }
        
        // Text Analysis Tab Functionality
        function showTab(tabId, btnElement) {
            // Get the parent item container
            const itemContainer = btnElement.closest('.item-analysis');
            
            // Hide all tab contents in this item
            const tabContents = itemContainer.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons in this item
            const tabBtns = itemContainer.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and activate button
            document.getElementById(tabId).classList.add('active');
            btnElement.classList.add('active');
        }
    </script>
</body>
</html>