<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JP-test - MARC Records</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; line-height: 1.6; background: #fafafa; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 2em; font-weight: 300; }
        .header p { margin: 10px 0 0; opacity: 0.9; }
        
        /* Image Gallery */
        .image-gallery { display: flex; gap: 15px; overflow-x: auto; padding: 20px 0; margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .thumbnail-container { flex-shrink: 0; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .thumbnail-container:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .thumbnail { width: 200px; height: 300px; object-fit: cover; border-radius: 8px; border: 3px solid #e0e0e0; transition: border-color 0.2s ease; }
        .thumbnail-container:hover .thumbnail { border-color: #667eea; }
        .thumbnail-label { text-align: center; margin-top: 8px; font-size: 0.85em; color: #666; font-weight: 500; word-break: break-word; max-width: 200px; }
        .no-images { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90vw; max-height: 90vh; }
        .modal-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 15px; right: 20px; color: white; font-size: 30px; font-weight: bold; cursor: pointer; z-index: 1001; width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; transition: background 0.2s ease; }
        .modal-close:hover { background: rgba(255,0,0,0.7); }
        .modal-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 15px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; transition: background 0.2s ease; }
        .modal-nav:hover { background: rgba(0,0,0,0.8); }
        .modal-prev { left: 20px; }
        .modal-next { right: 20px; }
        .modal-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        
        /* MARC Records */
        .records-section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin: 30px 0 20px; }
        .marc-record { background: white; border: none; margin-bottom: 25px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .marc-record h3 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .confidence { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); padding: 6px 12px; border-radius: 20px; display: inline-block; margin-bottom: 15px; color: #2c5530; font-weight: 500; font-size: 0.9em; }
        .review-flag { background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border: none; color: #d63031; padding: 6px 12px; border-radius: 20px; margin-bottom: 15px; font-weight: 500; font-size: 0.9em; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #f0f0f0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; width: 100px; }
        .subfield-code { font-weight: bold; color: #667eea; background: #f8f9ff; padding: 2px 4px; border-radius: 3px; margin-right: 5px; }
        .no-records { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* External API Results */
        .api-results-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .api-results-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .api-summary { background: #f8f9ff; border: 1px solid #e0e6ff; border-radius: 6px; padding: 12px; margin-bottom: 20px; }
        .api-summary p { margin: 0; color: #333; font-size: 0.95em; }
        .api-source { margin-bottom: 20px; }
        .api-source h3 { color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .api-matches { background: #f8f9ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .api-match { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .api-match:last-child { margin-bottom: 0; }
        .match-title { font-weight: 600; color: #333; margin-bottom: 5px; }
        .match-author { color: #666; margin-bottom: 5px; }
        .match-details { font-size: 0.9em; color: #888; }
        .no-matches { text-align: center; padding: 20px; color: #999; font-style: italic; }
        .api-no-results { }
        .search-details { background: #f8f9fa; border-radius: 6px; padding: 15px; margin-top: 15px; }
        .search-details h4 { margin-top: 0; color: #495057; }
        .search-details ul { margin: 10px 0; padding-left: 20px; }
        .search-details li { margin-bottom: 5px; color: #6c757d; }
        .search-details em { color: #6c757d; }
        .authority-result { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 10px; }
        .authority-valid { background: #d4edda; color: #155724; }
        .authority-invalid { background: #f8d7da; color: #721c24; }
        
        /* JSON Tree View */
        .json-tree-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .json-tree-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .tree-container { border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #fafafa; max-height: 600px; overflow-y: auto; font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace; }
        .expand-all-btn, .collapse-all-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 10px; margin-bottom: 15px; font-size: 0.9em; transition: transform 0.2s ease; }
        .expand-all-btn:hover, .collapse-all-btn:hover { transform: translateY(-1px); }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.9em; background: white; border-radius: 10px; margin-top: 30px; }
        .footer a { color: #667eea; text-decoration: none; font-weight: 500; }
        .footer a:hover { text-decoration: underline; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .thumbnail { width: 150px; height: 225px; }
            .thumbnail-label { max-width: 150px; }
            .modal-nav { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>JP-test</h1>
        <p>üìö MARC Records generated by marcsnarc on 2025-12-23 09:44:09</p>
    </div>
    
    <div class='image-gallery'>

                <div class='thumbnail-container' onclick='openModal(0)'>
                    <img src='img_PXL_20251212_165802824.webp' alt='PXL_20251212_165802824.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165802824.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(1)'>
                    <img src='img_PXL_20251212_165807773.webp' alt='PXL_20251212_165807773.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165807773.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(2)'>
                    <img src='img_PXL_20251212_165816342.webp' alt='PXL_20251212_165816342.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165816342.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(3)'>
                    <img src='img_PXL_20251212_165825246.webp' alt='PXL_20251212_165825246.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165825246.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(4)'>
                    <img src='img_PXL_20251212_165928834.webp' alt='PXL_20251212_165928834.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165928834.jpg</div>
                </div>
                </div>

    
    <!-- Modal for image viewing -->
    <div id="imageModal" class="modal">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <button class="modal-nav modal-prev" onclick="changeImage(-1)">‚Äπ</button>
        <button class="modal-nav modal-next" onclick="changeImage(1)">‚Ä∫</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>
        <div class="modal-counter" id="modalCounter"></div>
    </div>
    
    <div class="records-section">
        <h2>üìã MARC Records</h2>
        <div class='marc-record'>
<h3>Record 1</h3>
<div class='confidence'>Confidence: 0.57</div>
<div class='review-flag'>‚ö†Ô∏è Review Required</div>
<table><tr><th>LDR</th><td>00000nam a200000 Ki 500</td></tr><tr><th>001</th><td>msn20251223154409</td></tr><tr><th>003</th><td>DLC</td></tr><tr><th>005</th><td>20251223154409.0</td></tr><tr><th>008</th><td>251223s1937                o     00und und d</td></tr><tr><th>040</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>DLC <span class="subfield-code">‚Ä°b</span>eng <span class="subfield-code">‚Ä°c</span>DLC <span class="subfield-code">‚Ä°e</span>rda </td></tr><tr><th>245</th><td><strong>00</strong> <span class="subfield-code">‚Ä°a</span>JP-test </td></tr><tr><th>264</th><td><strong>_1</strong> <span class="subfield-code">‚Ä°c</span>1937 </td></tr><tr><th>300</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>5 items (various formats) </td></tr><tr><th>520</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection consists of 2 books, 1 serials, 2 other items. Items date from 1937 to 1937. </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection-level record for 5 items </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Provenance: Extracted from 6 images using marcsnarc </td></tr><tr><th>561</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Extracted from 6 images using marcsnarc </td></tr><tr><th>999</th><td><strong>__</strong> <span class="subfield-code">‚Ä°i</span>Generated by marcsnarc on 2025-12-23 <span class="subfield-code">‚Ä°s</span>marcsnarc </td></tr></table></div>

    </div>
    
    <div class="api-results-section">
<h2>üåê External API Results</h2>
<div class="api-summary">
<p><strong>Search Summary:</strong> 2 item(s) searched across WorldCat, Library of Congress, and Alma catalogs</p>
</div>
<div class="api-no-results">
<div class="no-matches">External catalog searches were performed but no matches were found.</div>
<div class="search-details">
<p><strong>Search Status by Service:</strong></p>
<ul>
<li><strong>üìö WorldCat:</strong> Search attempted - likely failed due to server issues or no matches</li>
<li><strong>üèõÔ∏è Library of Congress:</strong> Authority validation performed</li>
<li><strong>üéì Alma Catalog:</strong> Local catalog searched</li>
</ul>
<p><em>Check the processing logs for detailed error messages.</em></p>
</div>
</div>
</div>

    
    
            <div class='json-tree-section'>
                <h2>üìä Analysis Data</h2>
                <div class='tree-container' id='analysis-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("analysis-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("analysis-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
            <div class='json-tree-section'>
                <h2>üìã Processing Metadata</h2>
                <div class='tree-container' id='metadata-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("metadata-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("metadata-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
    
    <div class="footer">
        Generated with <a href="https://github.com/anthropics/marcsnarc">marcsnarc</a> - AI-powered MARC cataloging
    </div>
    
    <script>
        // Global variables for modal and JSON data
        let currentImages = [];
        let currentImageIndex = 0;
        const analysisData = {"collection_analysis": {"item_count": 5, "formats": {"format_counts": {"periodical": 1, "pamphlet": 1, "note|memo": 1, "book": 1, "magazine": 1}, "unique_formats": "{'periodical', 'magazine', 'book', 'pamphlet', 'note|memo'}", "books": 2, "serials": 1, "ephemera": 0, "other": 2, "primary_format": "periodical"}, "creators": {"creator_counts": {"ÊÅ©‰∫ïÊö¢È¥¨": 1}, "unique_creators": "{'ÊÅ©‰∫ïÊö¢È¥¨'}", "items_with_creators": 1, "items_without_creators": 4, "dominant_creator": ["ÊÅ©‰∫ïÊö¢È¥¨", 1]}, "dates": {"date_range": [1937, 1937], "earliest_date": 1937, "latest_date": 1937, "date_span": 0, "items_with_dates": 1, "date_counts": {"1937": 1}}, "languages": {"language_counts": {"japanese and english": 1, "jpn": 1, "eng": 1, "english and japanese": 1, "english with japanese elements": 1}, "unique_languages": "{'english and japanese', 'jpn', 'japanese and english', 'eng', 'english with japanese elements'}", "primary_language": "japanese and english", "multilingual": true}, "subjects": {"subject_counts": {"Sino-Japanese War (1937-1945)": 1, "War photography": 1, "Japanese military propaganda": 1, "China Incident": 1, "World War II": 1, "Manchuria": 1, "Dance": 1, "Music": 1, "Maps": 1, "Cultural studies": 1, "personal notes": 1, "memoranda": 1, "reminders": 1, "Osaka": 1, "Japanese history": 1, "Greater East Asia War": 1, "Bibliography": 1, "China-Japan relations": 1, "Japanese ambassadors": 1, "Palace architecture": 1, "Japan's war in greater East Asia": 1, "monthly illustrated magazine": 1, "photographs": 1, "advertisements": 1, "Combined Fleet": 1, "Burma front": 1, "Admiral Soemu Toyoda": 1, "Koga commander": 1, "combined fleet": 1}, "unique_subjects": "{'Palace architecture', 'China Incident', 'Osaka', 'advertisements', 'Koga commander', 'reminders', 'Japanese history', \"Japan's war in greater East Asia\", 'memoranda', 'Sino-Japanese War (1937-1945)', 'Admiral Soemu Toyoda', 'China-Japan relations', 'World War II', 'Burma front', 'photographs', 'Dance', 'monthly illustrated magazine', 'Manchuria', 'Combined Fleet', 'Japanese military propaganda', 'Music', 'Japanese ambassadors', 'Maps', 'Bibliography', 'combined fleet', 'Greater East Asia War', 'War photography', 'Cultural studies', 'personal notes'}", "items_with_subjects": 5, "common_subjects": [["Sino-Japanese War (1937-1945)", 1], ["War photography", 1], ["Japanese military propaganda", 1], ["China Incident", 1], ["World War II", 1]], "subject_coherence": 2.9}, "provenance": {"collection_provenance": "Extracted from 6 images using marcsnarc", "item_provenances": {}, "consistency_score": 1.0, "has_provenance": true}, "identifiers": {"items_with_isbn": 0, "items_with_issn": 0, "items_with_oclc": 0, "items_with_lccn": 0, "identifier_coverage": 0.0}, "physical_characteristics": {"extent_variety": 4, "dimension_variety": 4, "physical_coherence": 0.19999999999999996}, "format_diversity": 5, "creator_diversity": 1, "has_books_serials": true, "shared_provenance": true, "temporal_coherence": 1.0, "workflow_type": "collection_images_to_marc", "collection_name": "JP-test", "processing_timestamp": "2025-12-23T09:44:09.514619", "total_records": 1, "approach": "collection"}, "batch_analysis": {"collection_name": "JP-test", "total_images": 6, "successful_analyses": 5, "failed_analyses": 1, "individual_results": [{"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165807773.jpg", "extracted_data": {"title": "The Shina Jihen Gaho", "subtitle": "The China Incident Pictorial", "publication_place": "Osaka; Tokyo", "publication_date": "1937-1939", "normalized_date": {"normalized": "1937", "end_date": "1939", "circa": false, "uncertain": false, "original": "1937-1939"}, "format": "periodical", "extent": "Multiple issues described", "language": "japanese and english", "original_script_title": "Japanese (including kanji/kana) and Latin script", "subjects": [{"heading": "Sino-Japanese War (1937-1945)", "type": "topical", "source": "claude_analysis"}, {"heading": "War photography", "type": "topical", "source": "claude_analysis"}, {"heading": "Japanese military propaganda", "type": "topical", "source": "claude_analysis"}, {"heading": "China Incident", "type": "topical", "source": "claude_analysis"}, {"heading": "World War II", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This appears to be a bibliographic catalog entry or index listing for issues of 'Shina Jihen Gaho' (ÊîØÈÇ£‰∫ãËÆäÁï´Â†±)", "source": "image_analysis"}, {"text": "The document lists multiple issues/covers dated from 1937-1939", "source": "image_analysis"}, {"text": "Entries include cover descriptions such as 'Soldiers in the trench, using a periscope', 'Japanese sniper on a rooftop', 'soldier climbs through a hole in a brick wall'", "source": "image_analysis"}, {"text": "Multiple publication dates mentioned: August 3, no. 1; August 12, no. 3; August 30, no. 5; October 21, no. 7; February 13, February 21, February 23, March 11, no. 22, April 14, no. 56, April 20, no. 57, September 1, no. 38", "source": "image_analysis"}, {"text": "The publication was issued during the Second Sino-Japanese War period", "source": "image_analysis"}, {"text": "Document indicates issues were purchased in early 2000s from eBay by Lingwai-t'u (reference: $15 per issue)", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.765, "creator": 0.2, "publication": 0.39, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.48425}, "overall_confidence": 0.48425, "claude_factors": {"text_clarity": "high", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "ÊîØÈÇ£‰∫ãËÆäÁï´Â†± Shina Jihen gaho", "language": "Japanese and English", "location": "title entry"}, {"text": "Osaka mai nichi, Tokyo nichi nichi", "language": "English romanization", "location": "publisher information"}, {"text": "ÊîØÈÇ£‰∫ãËÆäÁï´Â†± Osaka mai nichi Shimbun sha", "language": "Japanese and English", "location": "publisher credit"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 1}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165928834.jpg", "extracted_data": {"title": "Ê∫ÄÊ¥≤Âú∞Âúñ (Mansh≈´ Chizu)", "subtitle": "Ê∫ÄÊ¥≤„ÅÆËàûË∏ä„Å®Èü≥Ê•Ω / Ê∫ÄÊ¥≤„ÅÆËàûË∏ä„Å®Èü≥Ê•Ω (Mansh≈´ no Buy≈ç to Ongaku / Mansh≈´ no Buy≈ç to Ongaku)", "creator": {"name": "ÊÅ©‰∫ïÊö¢È¥¨", "type": "personal", "source": "claude_analysis", "romanization": "Onoi Ch≈ç≈ç"}, "format": "pamphlet", "extent": "Single sheet or pamphlet page", "dimensions": "Approximately A4 or similar format", "language": "jpn", "original_script_title": "Japanese (Kanji and Kana)", "subjects": [{"heading": "Manchuria", "type": "topical", "source": "claude_analysis"}, {"heading": "Dance", "type": "topical", "source": "claude_analysis"}, {"heading": "Music", "type": "topical", "source": "claude_analysis"}, {"heading": "Maps", "type": "topical", "source": "claude_analysis"}, {"heading": "Cultural studies", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Document appears to be oriented sideways (rotated 90 degrees clockwise from viewing position)", "source": "image_analysis"}, {"text": "Contains photographic or illustrated imagery showing architectural scenes and a figure", "source": "image_analysis"}, {"text": "Shows signs of age with discoloration and wear", "source": "image_analysis"}, {"text": "Header contains additional Japanese text that appears to be publication or series information", "source": "image_analysis"}, {"text": "The document seems to be about dance and music of Manchuria with accompanying map reference", "source": "image_analysis"}, {"text": "Vintage Japanese publication, likely pre-1945 based on subject matter (Manchuria/Mansh≈´)", "source": "image_analysis"}, {"text": "Multiple text blocks visible with varying orientations", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.0, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.4365}, "overall_confidence": 0.4365, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "Ê∫ÄÊ¥≤Âú∞Âúñ", "language": "Japanese", "location": "title area"}, {"text": "Ê∫ÄÊ¥≤„ÅÆËàûË∏ä„Å®Èü≥Ê•Ω", "language": "Japanese", "location": "subtitle area"}, {"text": "ÊÅ©‰∫ïÊö¢È¥¨", "language": "Japanese", "location": "left margin (author credit)"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 2}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165802824.jpg", "extracted_data": {"title": "Bathroom?", "format": "note|memo", "extent": "1 sticky note", "dimensions": "approximately 3x3 inches (standard sticky note size)", "language": "eng", "original_script_title": "Latin", "subjects": [{"heading": "personal notes", "type": "topical", "source": "claude_analysis"}, {"heading": "memoranda", "type": "topical", "source": "claude_analysis"}, {"heading": "reminders", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Handwritten text on a blue sticky note", "source": "image_analysis"}, {"text": "The word appears to read 'Bathroom?' with a question mark", "source": "image_analysis"}, {"text": "Written in blue or black ink in cursive/handwriting", "source": "image_analysis"}, {"text": "Note is photographed on a wooden surface", "source": "image_analysis"}, {"text": "Appears to be a casual reminder or query note", "source": "image_analysis"}, {"text": "Not a formal bibliographic item", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.0, "format": 0.5850000000000001, "language": 0.5850000000000001, "overall": 0.37475}, "overall_confidence": 0.37475, "claude_factors": {"text_clarity": "medium", "completeness": "high", "language_certainty": "high"}, "original_text_regions": [{"text": "Bathroom?", "language": "English", "location": "center of note"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 3}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165855357.jpg", "sequence_number": 4, "error": "Failed to analyze image examples/Japanese Prints in OCLC/PXL_20251212_165855357.jpg: Claude API analysis failed: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'messages.0.content.1.image.source.base64: image exceeds 5 MB maximum: 5812260 bytes > 5242880 bytes'}, 'request_id': 'req_011CWPsjXYFUf6UGhTNLvFwv'}", "overall_confidence": 0.0, "extracted_data": null}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165816342.jpg", "extracted_data": {"title": "Bibliography entries for works about Osaka and Greater East Asia War", "format": "book", "extent": "Single page visible", "dimensions": "Standard letter or A4 size (approximate)", "language": "english and japanese", "original_script_title": "Latin script and Japanese (mix of Kanji, Hiragana, Katakana)", "subjects": [{"heading": "Osaka", "type": "topical", "source": "claude_analysis"}, {"heading": "Japanese history", "type": "topical", "source": "claude_analysis"}, {"heading": "Greater East Asia War", "type": "topical", "source": "claude_analysis"}, {"heading": "Bibliography", "type": "topical", "source": "claude_analysis"}, {"heading": "China-Japan relations", "type": "topical", "source": "claude_analysis"}, {"heading": "Japanese ambassadors", "type": "topical", "source": "claude_analysis"}, {"heading": "Palace architecture", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This appears to be a bibliography or reference page from an academic work", "source": "image_analysis"}, {"text": "Contains multiple entries in both English and Japanese with romanization", "source": "image_analysis"}, {"text": "References include works about Osaka city, Chinese national government under Wang Jingwei, Japanese ambassadors, and various historical topics", "source": "image_analysis"}, {"text": "Entries are numbered (shows entries 14, 15, and others)", "source": "image_analysis"}, {"text": "Mix of romanized Japanese titles with English translations provided in brackets", "source": "image_analysis"}, {"text": "Contains references to works published in early 2000s (2006 mentioned)", "source": "image_analysis"}, {"text": "Some entries reference Showa era publications (Showa 18, 19 = 1943, 1944)", "source": "image_analysis"}, {"text": "Topics include palace construction, diplomatic history, and wartime publications", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.0, "format": 0.26, "language": 0.5850000000000001, "overall": 0.326}, "overall_confidence": 0.326, "claude_factors": {"text_clarity": "medium", "completeness": "low", "language_certainty": "high"}, "original_text_regions": [{"text": "Dai dai setsuo sho Â§ßÂ§ßÊëÇÊ¥•Â∫Ñ", "language": "Japanese", "location": "bibliography entry"}, {"text": "Osaka-fu: Osaka mainichi shinbunsha Â§ßÈò™Â∫ú: Â§ßÈò™ÊØèÊó•Êñ∞ËÅûÁ§æ", "language": "Japanese", "location": "publication information"}, {"text": "Greater East Asia War: Pictorial", "language": "English", "location": "title reference"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Bibliographic information appears incomplete in image", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 5}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165825246.jpg", "extracted_data": {"title": "T≈çky≈ç nichi nichi shimbunsha sen'y≈ç kiji Êñ∞ËÅûÁ§æ: A large format monthly illustrated magazine devoted to the news of Japan's war in greater East Asia", "publication_place": "Utzigawa123, via Ebay", "publication_date": "2000s (the early 2000s)", "normalized_date": {"normalized": null, "end_date": null, "circa": false, "uncertain": true, "original": "2000s (the early 2000s)"}, "format": "magazine", "dimensions": "large format (as mentioned in text)", "language": "english with japanese elements", "original_script_title": "Latin script with Japanese characters (Êñ∞ËÅûÁ§æ)", "other_identifiers": "Total issues held: 19. Cataloged July, 2019.", "subjects": [{"heading": "Japan's war in greater East Asia", "type": "topical", "source": "claude_analysis"}, {"heading": "monthly illustrated magazine", "type": "topical", "source": "claude_analysis"}, {"heading": "photographs", "type": "topical", "source": "claude_analysis"}, {"heading": "advertisements", "type": "topical", "source": "claude_analysis"}, {"heading": "Combined Fleet", "type": "topical", "source": "claude_analysis"}, {"heading": "Burma front", "type": "topical", "source": "claude_analysis"}, {"heading": "Admiral Soemu Toyoda", "type": "topical", "source": "claude_analysis"}, {"heading": "Koga commander", "type": "topical", "source": "claude_analysis"}, {"heading": "combined fleet", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Includes a day by day summary of the month's news", "source": "image_analysis"}, {"text": "Rear covers are advertisements", "source": "image_analysis"}, {"text": "Contents: front cover; Admiral Soemu Toyoda, commander of the Combined Fleet, standing on the bridge, India Burma front, Soemu Toyoda", "source": "image_analysis"}, {"text": "Death of Admiral Mineichi Koga, commander of the combined fleet, Leyang Condition", "source": "image_analysis"}, {"text": "Purchased from Utzigawa123 via Ebay", "source": "image_analysis"}, {"text": "Four small holes punctuated along edge", "source": "image_analysis"}, {"text": "Excellent. Disbound, with four small holes punctuated along edge", "source": "image_analysis"}, {"text": "Text appears to be a catalog description or acquisition note", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.765, "creator": 0.2, "publication": 0.39, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.48425}, "overall_confidence": 0.48425, "claude_factors": {"text_clarity": "high", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "T≈çky≈ç nichi nichi shimbunsha sen'y≈ç kiji Êñ∞ËÅûÁ§æ: A large format monthly illustrated magazine devoted to the news of Japan's war in greater East Asia. Includes a day by day summary of the month's news. Photographs are u&w only. Rear covers are advertisements. Contents: front cover; Admiral Soemu Toyoda, commander of the Combined Fleet, standing on the bridge, India Burma front, Soemu Toyoda, commander of the Combined Fleet, Leyang Condition. Beiganville. Death of Admiral Mineichi Koga, commander of the combined fleet, Leyang Condition. Excellent. Disbound, with four small holes punctuated along edge. Purchased from Utzigawa123 via Ebay in the early 2000s. ++++++++ Total issues held: 19. Cataloged July, 2019.", "language": "English with Japanese", "location": "verso/description page"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 6}], "collection_analysis": {"total_items": 6, "successful_extractions": 5, "common_characteristics": {"primary_language": "japanese and english", "language_distribution": {"japanese and english": 1, "jpn": 1, "eng": 1, "english and japanese": 1, "english with japanese elements": 1}, "primary_format": "periodical", "format_distribution": {"periodical": 1, "pamphlet": 1, "note|memo": 1, "book": 1, "magazine": 1}}, "quality_assessment": {"average_confidence": 0.42115, "high_confidence_items": 0, "low_confidence_items": 5, "confidence_range": [0.326, 0.48425]}, "recommendations": ["More than 30% of items have low confidence - consider manual review", "Multiple languages detected - verify language coding", "5 items contain CJK characters - verify romanization"]}, "batch_confidence": 0.35095833333333337, "processing_timestamp": "2025-12-23T09:44:09.512416"}, "individual_extractions": [{"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165807773.jpg", "extraction_confidence": 0.48425, "extracted_fields": ["title", "subtitle", "publication_place", "publication_date", "normalized_date", "format", "extent", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165928834.jpg", "extraction_confidence": 0.4365, "extracted_fields": ["title", "subtitle", "creator", "format", "extent", "dimensions", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165802824.jpg", "extraction_confidence": 0.37475, "extracted_fields": ["title", "format", "extent", "dimensions", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165816342.jpg", "extraction_confidence": 0.326, "extracted_fields": ["title", "format", "extent", "dimensions", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Japanese Prints in OCLC/PXL_20251212_165825246.jpg", "extraction_confidence": 0.48425, "extracted_fields": ["title", "publication_place", "publication_date", "normalized_date", "format", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}], "external_api_results": [{"worldcat": [], "loc": [], "alma": [], "best_match": null}]};
        const metadataData = {"workflow_type": "collection_images_to_marc", "collection_name": "JP-test", "processing_result": {"approach": "collection", "records_generated": 1, "review_required": true, "groupings": {"approach": "collection", "total_items": 5, "groups": [{"type": "collection", "items": ["The Shina Jihen Gaho", "Ê∫ÄÊ¥≤Âú∞Âúñ (Mansh≈´ Chizu)", "Bathroom?", "Bibliography entries for works about Osaka and Greater East Asia War", "T≈çky≈ç nichi nichi shimbunsha sen'y≈ç kiji Êñ∞ËÅûÁ§æ: A large format monthly illustrated magazine devoted to the news of Japan's war in greater East Asia"], "record_type": "collection"}]}}, "collection_data": {"total_items": 5, "source_images": ["examples/Japanese Prints in OCLC/PXL_20251212_165807773.jpg", "examples/Japanese Prints in OCLC/PXL_20251212_165928834.jpg", "examples/Japanese Prints in OCLC/PXL_20251212_165802824.jpg", "examples/Japanese Prints in OCLC/PXL_20251212_165816342.jpg", "examples/Japanese Prints in OCLC/PXL_20251212_165825246.jpg"], "provenance": "Extracted from 6 images using marcsnarc"}, "batch_analysis_summary": {"total_images": 6, "successful_analyses": 5, "batch_confidence": 0.35095833333333337}, "processing_timestamp": "2025-12-23T09:44:09.514637"};
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize images array from gallery
            const thumbnails = document.querySelectorAll('.thumbnail');
            currentImages = Array.from(thumbnails).map(img => ({
                src: img.src,
                alt: img.alt
            }));
            
            // Initialize JSON trees
            if (analysisData && Object.keys(analysisData).length > 0) {
                renderJsonTree('analysis-tree', analysisData);
            }
            if (metadataData && Object.keys(metadataData).length > 0) {
                renderJsonTree('metadata-tree', metadataData);
            }
        });
        
        // Modal functions
        function openModal(index) {
            currentImageIndex = index;
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const counter = document.getElementById('modalCounter');
            
            if (currentImages[index]) {
                modalImage.src = currentImages[index].src;
                modalImage.alt = currentImages[index].alt;
                counter.textContent = `${index + 1} of ${currentImages.length}`;
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + currentImages.length) % currentImages.length;
            openModal(currentImageIndex);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') closeModal();
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
            }
        });
        
        // Close modal on background click
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // JSON Tree rendering functions
        function renderJsonTree(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container || !data) return;
            
            container.innerHTML = '';
            const tree = createTreeElement(data, '', 0);
            container.appendChild(tree);
        }
        
        function createTreeElement(value, key, level) {
            const wrapper = document.createElement('div');
            wrapper.style.marginLeft = `${level * 20}px`;
            wrapper.style.marginBottom = '3px';
            
            if (value && typeof value === 'object' && !Array.isArray(value)) {
                // Object
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                Object.entries(value).forEach(([childKey, childValue]) => {
                    children.appendChild(createTreeElement(childValue, childKey, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìÇ ${key} {${Object.keys(value).length}}</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else if (Array.isArray(value)) {
                // Array
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                value.forEach((item, index) => {
                    children.appendChild(createTreeElement(item, `[${index}]`, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìñ ${key} [${value.length}]</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else {
                // Primitive value
                const element = document.createElement('div');
                const valueStr = value === null ? 'null' : String(value);
                const valueType = typeof value;
                let color = '#4a5568';
                let icon = 'üìÑ';
                
                if (valueType === 'string') { color = '#38a169'; icon = 'üìù'; }
                else if (valueType === 'number') { color = '#d69e2e'; icon = 'üî¢'; }
                else if (valueType === 'boolean') { color = '#9f7aea'; icon = '‚úÖ'; }
                else if (value === null) { color = '#a0aec0'; icon = '‚ùå'; }
                
                element.innerHTML = `<span style="color: #2d3748; font-weight: 600;">${icon} ${key}:</span> <span style="color: ${color};">${valueType === 'string' ? '"' + valueStr + '"' : valueStr}</span>`;
                wrapper.appendChild(element);
            }
            
            return wrapper;
        }
        
        function expandAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñ∂')) {
                    span.parentElement.click();
                }
            });
        }
        
        function collapseAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñº')) {
                    span.parentElement.click();
                }
            });
        }
    </script>
</body>
</html>