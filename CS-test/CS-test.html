<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CS-test - MARC Records</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; line-height: 1.6; background: #fafafa; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 2em; font-weight: 300; }
        .header p { margin: 10px 0 0; opacity: 0.9; }
        
        /* Image Gallery */
        .image-gallery { display: flex; gap: 15px; overflow-x: auto; padding: 20px 0; margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .thumbnail-container { flex-shrink: 0; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .thumbnail-container:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .thumbnail { width: 200px; height: 300px; object-fit: cover; border-radius: 8px; border: 3px solid #e0e0e0; transition: border-color 0.2s ease; }
        .thumbnail-container:hover .thumbnail { border-color: #667eea; }
        .thumbnail-label { text-align: center; margin-top: 8px; font-size: 0.85em; color: #666; font-weight: 500; word-break: break-word; max-width: 200px; }
        .no-images { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90vw; max-height: 90vh; }
        .modal-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 15px; right: 20px; color: white; font-size: 30px; font-weight: bold; cursor: pointer; z-index: 1001; width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; transition: background 0.2s ease; }
        .modal-close:hover { background: rgba(255,0,0,0.7); }
        .modal-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 15px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; transition: background 0.2s ease; }
        .modal-nav:hover { background: rgba(0,0,0,0.8); }
        .modal-prev { left: 20px; }
        .modal-next { right: 20px; }
        .modal-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        
        /* MARC Records */
        .records-section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin: 30px 0 20px; }
        .marc-record { background: white; border: none; margin-bottom: 25px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .marc-record h3 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .confidence { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); padding: 6px 12px; border-radius: 20px; display: inline-block; margin-bottom: 15px; color: #2c5530; font-weight: 500; font-size: 0.9em; }
        .review-flag { background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border: none; color: #d63031; padding: 6px 12px; border-radius: 20px; margin-bottom: 15px; font-weight: 500; font-size: 0.9em; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #f0f0f0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; width: 100px; }
        .subfield-code { font-weight: bold; color: #667eea; background: #f8f9ff; padding: 2px 4px; border-radius: 3px; margin-right: 5px; }
        .no-records { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* External API Results */
        .api-results-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .api-results-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .api-source { margin-bottom: 20px; }
        .api-source h3 { color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .api-matches { background: #f8f9ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .api-match { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .api-match:last-child { margin-bottom: 0; }
        .match-title { font-weight: 600; color: #333; margin-bottom: 5px; }
        .match-author { color: #666; margin-bottom: 5px; }
        .match-details { font-size: 0.9em; color: #888; }
        .no-matches { text-align: center; padding: 20px; color: #999; font-style: italic; }
        .authority-result { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 10px; }
        .authority-valid { background: #d4edda; color: #155724; }
        .authority-invalid { background: #f8d7da; color: #721c24; }
        
        /* JSON Tree View */
        .json-tree-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .json-tree-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .tree-container { border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #fafafa; max-height: 600px; overflow-y: auto; font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace; }
        .expand-all-btn, .collapse-all-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 10px; margin-bottom: 15px; font-size: 0.9em; transition: transform 0.2s ease; }
        .expand-all-btn:hover, .collapse-all-btn:hover { transform: translateY(-1px); }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.9em; background: white; border-radius: 10px; margin-top: 30px; }
        .footer a { color: #667eea; text-decoration: none; font-weight: 500; }
        .footer a:hover { text-decoration: underline; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .thumbnail { width: 150px; height: 225px; }
            .thumbnail-label { max-width: 150px; }
            .modal-nav { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CS-test</h1>
        <p>üìö MARC Records generated by marcsnarc on 2025-12-22 16:50:27</p>
    </div>
    
    <div class='image-gallery'>

                <div class='thumbnail-container' onclick='openModal(0)'>
                    <img src='img_PXL_20251212_164911546.webp' alt='PXL_20251212_164911546.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164911546.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(1)'>
                    <img src='img_PXL_20251212_164937723.webp' alt='PXL_20251212_164937723.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164937723.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(2)'>
                    <img src='img_PXL_20251212_165121702.webp' alt='PXL_20251212_165121702.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165121702.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(3)'>
                    <img src='img_PXL_20251212_165136484.webp' alt='PXL_20251212_165136484.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165136484.jpg</div>
                </div>
                </div>

    
    <!-- Modal for image viewing -->
    <div id="imageModal" class="modal">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <button class="modal-nav modal-prev" onclick="changeImage(-1)">‚Äπ</button>
        <button class="modal-nav modal-next" onclick="changeImage(1)">‚Ä∫</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>
        <div class="modal-counter" id="modalCounter"></div>
    </div>
    
    <div class="records-section">
        <h2>üìã MARC Records</h2>
        <div class='marc-record'>
<h3>Record 1</h3>
<div class='confidence'>Confidence: 0.47</div>
<div class='review-flag'>‚ö†Ô∏è Review Required</div>
<table><tr><th>LDR</th><td>00000nam a200000 Ki 500</td></tr><tr><th>001</th><td>msn20251222225026</td></tr><tr><th>003</th><td>DLC</td></tr><tr><th>005</th><td>20251222225026.0</td></tr><tr><th>008</th><td>251222m18961948            o     00chi und d</td></tr><tr><th>040</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>DLC <span class="subfield-code">‚Ä°b</span>eng <span class="subfield-code">‚Ä°c</span>DLC <span class="subfield-code">‚Ä°e</span>rda </td></tr><tr><th>245</th><td><strong>00</strong> <span class="subfield-code">‚Ä°a</span>CS-test </td></tr><tr><th>264</th><td><strong>_1</strong> <span class="subfield-code">‚Ä°c</span>1896 </td></tr><tr><th>300</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>4 items (various formats) </td></tr><tr><th>520</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection consists of 1 books, 3 serials. Items date from 1896 to 1948. </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection-level record for 4 items </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Provenance: Extracted from 4 images using marcsnarc </td></tr><tr><th>561</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Extracted from 4 images using marcsnarc </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Overseas Chinese </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Weekly newspaper </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Chinese periodical </td></tr><tr><th>999</th><td><strong>__</strong> <span class="subfield-code">‚Ä°i</span>Generated by marcsnarc on 2025-12-22 <span class="subfield-code">‚Ä°s</span>marcsnarc </td></tr></table></div>

    </div>
    
    <div class="api-results-section">
<h2>üåê External API Results</h2>
<div class="api-source"><h3>Record 1</h3>
</div>
<div class="api-source"><h3>Record 2</h3>
</div>
</div>

    
    
            <div class='json-tree-section'>
                <h2>üìä Analysis Data</h2>
                <div class='tree-container' id='analysis-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("analysis-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("analysis-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
            <div class='json-tree-section'>
                <h2>üìã Processing Metadata</h2>
                <div class='tree-container' id='metadata-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("metadata-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("metadata-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
    
    <div class="footer">
        Generated with <a href="https://github.com/anthropics/marcsnarc">marcsnarc</a> - AI-powered MARC cataloging
    </div>
    
    <script>
        // Global variables for modal and JSON data
        let currentImages = [];
        let currentImageIndex = 0;
        const analysisData = {"collection_analysis": {"item_count": 4, "formats": {"format_counts": {"book": 1, "newspaper": 3}, "unique_formats": "{'newspaper', 'book'}", "books": 1, "serials": 3, "ephemera": 0, "other": 0, "primary_format": "newspaper"}, "creators": {"creator_counts": {"ËèØÁæéÈÄ±ÂàäÁ§æ": 1}, "unique_creators": "{'ËèØÁæéÈÄ±ÂàäÁ§æ'}", "items_with_creators": 1, "items_without_creators": 3, "dominant_creator": ["ËèØÁæéÈÄ±ÂàäÁ§æ", 1]}, "dates": {"date_range": [1896, 1948], "earliest_date": 1896, "latest_date": 1948, "date_span": 52, "items_with_dates": 2, "date_counts": {"1896": 1, "1948": 1}}, "languages": {"language_counts": {"unable to determine from cover alone": 1, "chi": 3}, "unique_languages": "{'unable to determine from cover alone', 'chi'}", "primary_language": "chi", "multilingual": true}, "subjects": {"subject_counts": {"Based on catalog card: Shanghai": 1, "Huzhou": 1, "Hangzhou area": 1, "Overseas Chinese": 2, "Chinese diaspora": 1, "Weekly newspaper": 2, "Chinese periodical": 2, "Chinese American community": 1, "Weekly periodical": 1, "Chinese community publication": 1}, "unique_subjects": "{'Hangzhou area', 'Chinese diaspora', 'Weekly periodical', 'Chinese community publication', 'Overseas Chinese', 'Weekly newspaper', 'Chinese periodical', 'Based on catalog card: Shanghai', 'Chinese American community', 'Huzhou'}", "items_with_subjects": 4, "common_subjects": [["Overseas Chinese", 2], ["Weekly newspaper", 2], ["Chinese periodical", 2], ["Based on catalog card: Shanghai", 1], ["Huzhou", 1]], "subject_coherence": 1.775}, "provenance": {"collection_provenance": "Extracted from 4 images using marcsnarc", "item_provenances": {}, "consistency_score": 1.0, "has_provenance": true}, "identifiers": {"items_with_isbn": 0, "items_with_issn": 0, "items_with_oclc": 0, "items_with_lccn": 0, "identifier_coverage": 0.0}, "physical_characteristics": {"extent_variety": 3, "dimension_variety": 2, "physical_coherence": 0.375}, "format_diversity": 2, "creator_diversity": 1, "has_books_serials": true, "shared_provenance": true, "temporal_coherence": 0.2, "workflow_type": "collection_images_to_marc", "collection_name": "CS-test", "processing_timestamp": "2025-12-22T16:50:27.150672", "total_records": 1, "approach": "collection"}, "batch_analysis": {"collection_name": "CS-test", "total_images": 4, "successful_analyses": 4, "failed_analyses": 0, "individual_results": [{"image_path": "examples/Chinese Serials/PXL_20251212_164911546.jpg", "extracted_data": {"title": "No title visible on item", "creator": {"name": "Unknown", "type": null, "source": "claude_analysis"}, "publication_date": "circa 1896-1906 (based on catalog card)", "normalized_date": {"normalized": "1896", "end_date": "1906", "circa": true, "uncertain": false, "original": "circa 1896-1906 (based on catalog card)"}, "format": "book", "extent": "Single volume", "dimensions": "Approximately small format based on visual scale", "language": "unable to determine from cover alone", "other_identifiers": "Catalog number H.3 visible on card", "subjects": [{"heading": "Based on catalog card: Shanghai", "type": "topical", "source": "claude_analysis"}, {"heading": "Huzhou", "type": "topical", "source": "claude_analysis"}, {"heading": "Hangzhou area", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This appears to be a deteriorated book with severe cover damage", "source": "image_analysis"}, {"text": "Cover is dark green/black cloth with burgundy/maroon panel", "source": "image_analysis"}, {"text": "Significant paint or surface material loss on the burgundy panel", "source": "image_analysis"}, {"text": "Accompanied by a library catalog card with detailed provenance information", "source": "image_analysis"}, {"text": "Catalog card references dates 1896-1906 and locations including Shanghai, Huzhou, and Hangzhou", "source": "image_analysis"}, {"text": "Card mentions connections to missionaries and American individuals", "source": "image_analysis"}, {"text": "Cover condition suggests historical archival material requiring conservation", "source": "image_analysis"}, {"text": "No spine text visible due to orientation and condition", "source": "image_analysis"}, {"text": "Item appears to be part of a library or archival collection", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.34, "creator": 0.30000000000000004, "publication": 0.08666666666666667, "format": 0.26, "language": 0.26, "overall": 0.25933333333333336}, "overall_confidence": 0.25933333333333336, "claude_factors": {"text_clarity": "low", "completeness": "low", "language_certainty": "low"}, "original_text_regions": [{"text": "H.3", "language": "English", "location": "catalog card"}, {"text": "Catalog card text referencing dates 1896-1906, Shanghai, Huzhou, Hangzhou, and various personal names", "language": "English", "location": "catalog card"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Text in image has low clarity - OCR may be inaccurate", "Bibliographic information appears incomplete in image", "Language identification has uncertainty"], "review_required": true, "sequence_number": 1}, {"image_path": "examples/Chinese Serials/PXL_20251212_165136484.jpg", "extracted_data": {"title": "ËèØÂÉëÈÄ±Â†±", "subtitle": "HWA KIEU WEEKLY", "format": "newspaper", "extent": "Single newspaper page", "language": "chi", "original_script_title": "Traditional Chinese characters", "subjects": [{"heading": "Overseas Chinese", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese diaspora", "type": "topical", "source": "claude_analysis"}, {"heading": "Weekly newspaper", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese periodical", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This appears to be a page from a Chinese overseas community newspaper", "source": "image_analysis"}, {"text": "Contains multiple columns of dense Chinese text in traditional characters", "source": "image_analysis"}, {"text": "Large red stamp/logo visible on right side of the page", "source": "image_analysis"}, {"text": "Page includes 'HWA KIEU WEEKLY' text in English", "source": "image_analysis"}, {"text": "Bottom of page shows 'LUMASUN' branding and '‰ø°Áæ©Êñ∞Ê∞ëÊ®Ç' text", "source": "image_analysis"}, {"text": "Appears to be a historical newspaper page, possibly mid-20th century based on printing style and paper quality", "source": "image_analysis"}, {"text": "The layout is typical of traditional Chinese newspaper formatting with vertical text columns", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.0, "format": 0.26, "language": 0.5850000000000001, "overall": 0.326}, "overall_confidence": 0.326, "claude_factors": {"text_clarity": "medium", "completeness": "low", "language_certainty": "high"}, "original_text_regions": [{"text": "ËèØÂÉëÈÄ±Â†±", "language": "Chinese", "location": "header/masthead"}, {"text": "HWA KIEU WEEKLY", "language": "English", "location": "header/masthead"}, {"text": "LUMASUN", "language": "English", "location": "bottom edge/footer"}, {"text": "‰ø°Áæ©Êñ∞Ê∞ëÊ®Ç", "language": "Chinese", "location": "bottom edge"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Bibliographic information appears incomplete in image", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 2}, {"image_path": "examples/Chinese Serials/PXL_20251212_165121702.jpg", "extracted_data": {"title": "ËèØÂÉëÈÄ±Â†±", "publication_place": "Pittsburgh, Chichago (visible on left margin)", "format": "newspaper", "extent": "Multi-page newspaper", "language": "chi", "original_script_title": "Traditional Chinese characters", "subjects": [{"heading": "Overseas Chinese", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese American community", "type": "topical", "source": "claude_analysis"}, {"heading": "Weekly periodical", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "The title 'ËèØÂÉëÈÄ±Â†±' appears in large red characters within a decorative border on the left side", "source": "image_analysis"}, {"text": "Text 'HWA MEI WEEKLY' appears in English on the left margin", "source": "image_analysis"}, {"text": "Publisher information visible on left margin includes 'Pittsburgh, Chichago' and 'THE HWA MEI'", "source": "image_analysis"}, {"text": "Additional text visible: 'We know Better in You' and reference to 'Chinese Soy'", "source": "image_analysis"}, {"text": "The newspaper appears to be from the mid-20th century based on paper quality and printing style", "source": "image_analysis"}, {"text": "Multiple columns of dense Chinese text visible", "source": "image_analysis"}, {"text": "Right side contains what appears to be a contents or index section with numbered entries", "source": "image_analysis"}, {"text": "Paper shows age-related discoloration", "source": "image_analysis"}, {"text": "Another publication visible at top of image", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.15166666666666667, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.38558333333333333}, "overall_confidence": 0.38558333333333333, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "ËèØÂÉëÈÄ±Â†±", "language": "Chinese", "location": "main title box on left side"}, {"text": "HWA MEI WEEKLY", "language": "English", "location": "left margin"}, {"text": "THE HWA MEI, Pittsburgh, Chichago", "language": "English", "location": "left margin publisher information"}, {"text": "We know Better in You", "language": "English", "location": "left margin"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 3}, {"image_path": "examples/Chinese Serials/PXL_20251212_164937723.jpg", "extracted_data": {"title": "HWA MEI WEEKLY", "creator": {"name": "ËèØÁæéÈÄ±ÂàäÁ§æ", "type": "corporate", "source": "claude_analysis", "romanization": "Hwa Mei Weekly Publisher"}, "publisher": "ËèØÁæéÈÄ±ÂàäÁ§æ (Hwa Mei Weekly Publisher)", "publication_place": "‰∏çÊòé (location unclear from image)", "publication_date": "Ê∞ëÂúã‰∏âÂçÅ‰∏ÉÂπ¥ (Republic of China Year 37, approximately 1948)", "normalized_date": {"normalized": "1948", "end_date": null, "circa": true, "uncertain": false, "original": "Ê∞ëÂúã‰∏âÂçÅ‰∏ÉÂπ¥ (Republic of China Year 37, approximately 1948)"}, "format": "newspaper", "extent": "Single newspaper page", "dimensions": "Standard newspaper format (exact dimensions not measurable)", "language": "chi", "original_script_title": "Traditional Chinese characters", "other_identifiers": "Á¨¨ÂçÅ‰∏ÉÂç∑Á¨¨‰∏ÄËôü (Volume 17, Issue 1) visible on right margin", "subjects": [{"heading": "Chinese periodical", "type": "topical", "source": "claude_analysis"}, {"heading": "Weekly newspaper", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese community publication", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "The publication appears to be a Chinese-language weekly newspaper", "source": "image_analysis"}, {"text": "Large red masthead reading 'HWA MEI WEEKLY' in English with Chinese characters ËèØÁæéÈÄ±Âàä", "source": "image_analysis"}, {"text": "The page shows dense columns of traditional Chinese text", "source": "image_analysis"}, {"text": "Publication information visible in left margin indicates this is Volume 17, Issue 1", "source": "image_analysis"}, {"text": "Text appears to be from the late 1940s based on date notation", "source": "image_analysis"}, {"text": "Physical condition shows aging and some deterioration", "source": "image_analysis"}, {"text": "The layout is typical of Chinese newspapers of this period with vertical text columns", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.45499999999999996, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.5275}, "overall_confidence": 0.5275, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "HWA MEI WEEKLY ËèØÁæéÈÄ±Âàä", "language": "English and Chinese", "location": "masthead"}, {"text": "Á¨¨ÂçÅ‰∏ÉÂç∑Á¨¨‰∏ÄËôü", "language": "Chinese", "location": "right margin header"}, {"text": "Ê∞ëÂúã‰∏âÂçÅ‰∏ÉÂπ¥", "language": "Chinese", "location": "left margin publication information"}, {"text": "ËèØÁæéÈÄ±ÂàäÁ§æ", "language": "Chinese", "location": "left margin publisher information"}], "processing_notes": ["Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 4}], "collection_analysis": {"total_items": 4, "successful_extractions": 4, "common_characteristics": {"primary_language": "chi", "language_distribution": {"unable to determine from cover alone": 1, "chi": 3}, "primary_format": "newspaper", "format_distribution": {"book": 1, "newspaper": 3}, "publishers": {"ËèØÁæéÈÄ±ÂàäÁ§æ (Hwa Mei Weekly Publisher)": 1}}, "quality_assessment": {"average_confidence": 0.3746041666666667, "high_confidence_items": 0, "low_confidence_items": 3, "confidence_range": [0.25933333333333336, 0.5275]}, "recommendations": ["More than 30% of items have low confidence - consider manual review", "Multiple languages detected - verify language coding", "3 items contain CJK characters - verify romanization"]}, "batch_confidence": 0.3746041666666667, "processing_timestamp": "2025-12-22T16:50:26.863658"}, "individual_extractions": [{"image_path": "examples/Chinese Serials/PXL_20251212_164911546.jpg", "extraction_confidence": 0.25933333333333336, "extracted_fields": ["title", "creator", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Chinese Serials/PXL_20251212_165136484.jpg", "extraction_confidence": 0.326, "extracted_fields": ["title", "subtitle", "format", "extent", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Chinese Serials/PXL_20251212_165121702.jpg", "extraction_confidence": 0.38558333333333333, "extracted_fields": ["title", "publication_place", "format", "extent", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Chinese Serials/PXL_20251212_164937723.jpg", "extraction_confidence": 0.5275, "extracted_fields": ["title", "creator", "publisher", "publication_place", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}], "external_api_results": [{"worldcat": [], "loc": [], "alma": [], "best_match": null}]};
        const metadataData = {"workflow_type": "collection_images_to_marc", "collection_name": "CS-test", "processing_result": {"approach": "collection", "records_generated": 1, "review_required": true, "groupings": {"approach": "collection", "total_items": 4, "groups": [{"type": "collection", "items": ["No title visible on item", "ËèØÂÉëÈÄ±Â†±", "ËèØÂÉëÈÄ±Â†±", "HWA MEI WEEKLY"], "record_type": "collection"}]}}, "collection_data": {"total_items": 4, "source_images": ["examples/Chinese Serials/PXL_20251212_164911546.jpg", "examples/Chinese Serials/PXL_20251212_165136484.jpg", "examples/Chinese Serials/PXL_20251212_165121702.jpg", "examples/Chinese Serials/PXL_20251212_164937723.jpg"], "provenance": "Extracted from 4 images using marcsnarc"}, "batch_analysis_summary": {"total_images": 4, "successful_analyses": 4, "batch_confidence": 0.3746041666666667}, "processing_timestamp": "2025-12-22T16:50:27.150693"};
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize images array from gallery
            const thumbnails = document.querySelectorAll('.thumbnail');
            currentImages = Array.from(thumbnails).map(img => ({
                src: img.src,
                alt: img.alt
            }));
            
            // Initialize JSON trees
            if (analysisData && Object.keys(analysisData).length > 0) {
                renderJsonTree('analysis-tree', analysisData);
            }
            if (metadataData && Object.keys(metadataData).length > 0) {
                renderJsonTree('metadata-tree', metadataData);
            }
        });
        
        // Modal functions
        function openModal(index) {
            currentImageIndex = index;
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const counter = document.getElementById('modalCounter');
            
            if (currentImages[index]) {
                modalImage.src = currentImages[index].src;
                modalImage.alt = currentImages[index].alt;
                counter.textContent = `${index + 1} of ${currentImages.length}`;
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + currentImages.length) % currentImages.length;
            openModal(currentImageIndex);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') closeModal();
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
            }
        });
        
        // Close modal on background click
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // JSON Tree rendering functions
        function renderJsonTree(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container || !data) return;
            
            container.innerHTML = '';
            const tree = createTreeElement(data, '', 0);
            container.appendChild(tree);
        }
        
        function createTreeElement(value, key, level) {
            const wrapper = document.createElement('div');
            wrapper.style.marginLeft = `${level * 20}px`;
            wrapper.style.marginBottom = '3px';
            
            if (value && typeof value === 'object' && !Array.isArray(value)) {
                // Object
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                Object.entries(value).forEach(([childKey, childValue]) => {
                    children.appendChild(createTreeElement(childValue, childKey, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìÇ ${key} {${Object.keys(value).length}}</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else if (Array.isArray(value)) {
                // Array
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                value.forEach((item, index) => {
                    children.appendChild(createTreeElement(item, `[${index}]`, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìñ ${key} [${value.length}]</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else {
                // Primitive value
                const element = document.createElement('div');
                const valueStr = value === null ? 'null' : String(value);
                const valueType = typeof value;
                let color = '#4a5568';
                let icon = 'üìÑ';
                
                if (valueType === 'string') { color = '#38a169'; icon = 'üìù'; }
                else if (valueType === 'number') { color = '#d69e2e'; icon = 'üî¢'; }
                else if (valueType === 'boolean') { color = '#9f7aea'; icon = '‚úÖ'; }
                else if (value === null) { color = '#a0aec0'; icon = '‚ùå'; }
                
                element.innerHTML = `<span style="color: #2d3748; font-weight: 600;">${icon} ${key}:</span> <span style="color: ${color};">${valueType === 'string' ? '"' + valueStr + '"' : valueStr}</span>`;
                wrapper.appendChild(element);
            }
            
            return wrapper;
        }
        
        function expandAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñ∂')) {
                    span.parentElement.click();
                }
            });
        }
        
        function collapseAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñº')) {
                    span.parentElement.click();
                }
            });
        }
    </script>
</body>
</html>