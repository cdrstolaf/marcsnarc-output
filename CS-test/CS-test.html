<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CS-test - MARC Records</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; line-height: 1.6; background: #fafafa; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 2em; font-weight: 300; }
        .header p { margin: 10px 0 0; opacity: 0.9; }
        
        /* Image Gallery */
        .image-gallery { display: flex; gap: 15px; overflow-x: auto; padding: 20px 0; margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .thumbnail-container { flex-shrink: 0; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .thumbnail-container:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .thumbnail { width: 200px; height: 300px; object-fit: cover; border-radius: 8px; border: 3px solid #e0e0e0; transition: border-color 0.2s ease; }
        .thumbnail-container:hover .thumbnail { border-color: #667eea; }
        .thumbnail-label { text-align: center; margin-top: 8px; font-size: 0.85em; color: #666; font-weight: 500; word-break: break-word; max-width: 200px; }
        .no-images { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90vw; max-height: 90vh; }
        .modal-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 15px; right: 20px; color: white; font-size: 30px; font-weight: bold; cursor: pointer; z-index: 1001; width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; transition: background 0.2s ease; }
        .modal-close:hover { background: rgba(255,0,0,0.7); }
        .modal-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 15px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; transition: background 0.2s ease; }
        .modal-nav:hover { background: rgba(0,0,0,0.8); }
        .modal-prev { left: 20px; }
        .modal-next { right: 20px; }
        .modal-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        
        /* MARC Records */
        .records-section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin: 30px 0 20px; }
        .marc-record { background: white; border: none; margin-bottom: 25px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .marc-record h3 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .confidence { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); padding: 6px 12px; border-radius: 20px; display: inline-block; margin-bottom: 15px; color: #2c5530; font-weight: 500; font-size: 0.9em; }
        .review-flag { background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border: none; color: #d63031; padding: 6px 12px; border-radius: 20px; margin-bottom: 15px; font-weight: 500; font-size: 0.9em; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #f0f0f0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; width: 100px; }
        .subfield-code { font-weight: bold; color: #667eea; background: #f8f9ff; padding: 2px 4px; border-radius: 3px; margin-right: 5px; }
        .no-records { text-align: center; padding: 40px; color: #999; font-style: italic; background: white; border-radius: 10px; margin-bottom: 30px; }
        
        /* External API Results */
        .api-results-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .api-results-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .api-summary { background: #f8f9ff; border: 1px solid #e0e6ff; border-radius: 6px; padding: 12px; margin-bottom: 20px; }
        .api-summary p { margin: 0; color: #333; font-size: 0.95em; }
        .api-source { margin-bottom: 20px; }
        .api-source h3 { color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .api-matches { background: #f8f9ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .api-match { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .api-match:last-child { margin-bottom: 0; }
        .match-title { font-weight: 600; color: #333; margin-bottom: 5px; }
        .match-author { color: #666; margin-bottom: 5px; }
        .match-details { font-size: 0.9em; color: #888; }
        .no-matches { text-align: center; padding: 20px; color: #999; font-style: italic; }
        .api-no-results { }
        .search-details { background: #f8f9fa; border-radius: 6px; padding: 15px; margin-top: 15px; }
        .search-details h4 { margin-top: 0; color: #495057; }
        .search-details ul { margin: 10px 0; padding-left: 20px; }
        .search-details li { margin-bottom: 5px; color: #6c757d; }
        .search-details em { color: #6c757d; }
        .authority-result { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 10px; }
        .authority-valid { background: #d4edda; color: #155724; }
        .authority-invalid { background: #f8d7da; color: #721c24; }
        
        /* JSON Tree View */
        .json-tree-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .json-tree-section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; font-weight: 600; }
        .tree-container { border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #fafafa; max-height: 600px; overflow-y: auto; font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace; }
        .expand-all-btn, .collapse-all-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 10px; margin-bottom: 15px; font-size: 0.9em; transition: transform 0.2s ease; }
        .expand-all-btn:hover, .collapse-all-btn:hover { transform: translateY(-1px); }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.9em; background: white; border-radius: 10px; margin-top: 30px; }
        .footer a { color: #667eea; text-decoration: none; font-weight: 500; }
        .footer a:hover { text-decoration: underline; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .thumbnail { width: 150px; height: 225px; }
            .thumbnail-label { max-width: 150px; }
            .modal-nav { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CS-test</h1>
        <p>üìö MARC Records generated by marcsnarc on 2025-12-23 13:45:15</p>
    </div>
    
    <div class='image-gallery'>

                <div class='thumbnail-container' onclick='openModal(0)'>
                    <img src='img_PXL_20251212_164911546.webp' alt='PXL_20251212_164911546.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164911546.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(1)'>
                    <img src='img_PXL_20251212_164937723.webp' alt='PXL_20251212_164937723.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_164937723.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(2)'>
                    <img src='img_PXL_20251212_165121702.webp' alt='PXL_20251212_165121702.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165121702.jpg</div>
                </div>
                
                <div class='thumbnail-container' onclick='openModal(3)'>
                    <img src='img_PXL_20251212_165136484.webp' alt='PXL_20251212_165136484.jpg' class='thumbnail' loading='lazy'>
                    <div class='thumbnail-label'>PXL_20251212_165136484.jpg</div>
                </div>
                </div>

    
    <!-- Modal for image viewing -->
    <div id="imageModal" class="modal">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <button class="modal-nav modal-prev" onclick="changeImage(-1)">‚Äπ</button>
        <button class="modal-nav modal-next" onclick="changeImage(1)">‚Ä∫</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>
        <div class="modal-counter" id="modalCounter"></div>
    </div>
    
    <div class="records-section">
        <h2>üìã MARC Records</h2>
        <div class='marc-record'>
<h3>Record 1</h3>
<div class='confidence'>Confidence: 0.47</div>
<div class='review-flag'>‚ö†Ô∏è Review Required</div>
<table><tr><th>LDR</th><td>00000nam a200000 Ki 500</td></tr><tr><th>001</th><td>msn20251223194514</td></tr><tr><th>003</th><td>DLC</td></tr><tr><th>005</th><td>20251223194514.0</td></tr><tr><th>008</th><td>251223s1939                o     00chi und d</td></tr><tr><th>040</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>DLC <span class="subfield-code">‚Ä°b</span>eng <span class="subfield-code">‚Ä°c</span>DLC <span class="subfield-code">‚Ä°e</span>rda </td></tr><tr><th>245</th><td><strong>00</strong> <span class="subfield-code">‚Ä°a</span>CS-test </td></tr><tr><th>264</th><td><strong>_1</strong> <span class="subfield-code">‚Ä°c</span>1939 </td></tr><tr><th>300</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>4 items (various formats) </td></tr><tr><th>520</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection consists of 1 books, 1 serials, 2 other items. Items date from 1939 to 1939. </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Collection-level record for 4 items </td></tr><tr><th>500</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Provenance: Extracted from 4 images using marcsnarc </td></tr><tr><th>561</th><td><strong>__</strong> <span class="subfield-code">‚Ä°a</span>Extracted from 4 images using marcsnarc </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Chinese American community </td></tr><tr><th>650</th><td><strong>_0</strong> <span class="subfield-code">‚Ä°a</span>Periodicals </td></tr><tr><th>999</th><td><strong>__</strong> <span class="subfield-code">‚Ä°i</span>Generated by marcsnarc on 2025-12-23 <span class="subfield-code">‚Ä°s</span>marcsnarc </td></tr></table></div>

    </div>
    
    <div class="api-results-section">
<h2>üåê External API Results</h2>
<div class="api-summary">
<p><strong>Search Summary:</strong> 2 item(s) searched across WorldCat, Library of Congress, and Alma catalogs</p>
</div>
<div class="api-source"><h3>Record 1</h3>
<div class="api-source">
<h3>üèõÔ∏è Library of Congress Authority Validation</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">subject_authority: Chinese American community</div>
<span class="authority-result authority-invalid">‚ùå Not found</span>
</div>
<div class="api-match">
<div class="match-title">subject_authority: Periodicals</div>
<span class="authority-result authority-invalid">‚ùå Not found</span>
</div>
</div>
</div>
<div class="api-source">
<h3>üéì Alma Catalog Search Results</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">Unknown Title</div>
</div>
</div>
</div>
<div class="api-source">
<h3>üéØ Best Match (from Alma)</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">Unknown Title</div>
<div class="match-details">Source: Alma catalog</div>
</div>
</div>
</div>
</div>
<div class="api-source"><h3>Record 2</h3>
<div class="api-source">
<h3>üèõÔ∏è Library of Congress Authority Validation</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">subject_authority: Chinese American community</div>
<span class="authority-result authority-invalid">‚ùå Not found</span>
</div>
<div class="api-match">
<div class="match-title">subject_authority: Periodicals</div>
<span class="authority-result authority-invalid">‚ùå Not found</span>
</div>
</div>
</div>
<div class="api-source">
<h3>üéì Alma Catalog Search Results</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">Unknown Title</div>
</div>
</div>
</div>
<div class="api-source">
<h3>üéØ Best Match (from Alma)</h3>
<div class="api-matches">
<div class="api-match">
<div class="match-title">Unknown Title</div>
<div class="match-details">Source: Alma catalog</div>
</div>
</div>
</div>
</div>
</div>

    
    
            <div class='json-tree-section'>
                <h2>üìä Analysis Data</h2>
                <div class='tree-container' id='analysis-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("analysis-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("analysis-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
            <div class='json-tree-section'>
                <h2>üìã Processing Metadata</h2>
                <div class='tree-container' id='metadata-tree'></div>
                <button class='expand-all-btn' onclick='expandAllNodes("metadata-tree")'>
                    üîç Expand All
                </button>
                <button class='collapse-all-btn' onclick='collapseAllNodes("metadata-tree")'>
                    üìÅ Collapse All
                </button>
            </div>
            
    
    <div class="footer">
        Generated with <a href="https://github.com/anthropics/marcsnarc">marcsnarc</a> - AI-powered MARC cataloging
    </div>
    
    <script>
        // Global variables for modal and JSON data
        let currentImages = [];
        let currentImageIndex = 0;
        const analysisData = {"collection_analysis": {"item_count": 4, "formats": {"format_counts": {"book": 1, "newspaper/periodical": 2, "newspaper": 1}, "unique_formats": "{'newspaper', 'book', 'newspaper/periodical'}", "books": 1, "serials": 1, "ephemera": 0, "other": 2, "primary_format": "newspaper/periodical"}, "creators": {"creator_counts": {"Uncertain - appears to be a memorial volume for Mr. Mu (Mu Xiansheng)": 1}, "unique_creators": "{'Uncertain - appears to be a memorial volume for Mr. Mu (Mu Xiansheng)'}", "items_with_creators": 1, "items_without_creators": 3, "dominant_creator": ["Uncertain - appears to be a memorial volume for Mr. Mu (Mu Xiansheng)", 1]}, "dates": {"date_range": [1939, 1939], "earliest_date": 1939, "latest_date": 1939, "date_span": 0, "items_with_dates": 1, "date_counts": {"1939": 1}}, "languages": {"language_counts": {"chi": 4}, "unique_languages": "{'chi'}", "primary_language": "chi", "multilingual": false}, "subjects": {"subject_counts": {"Memorial volume": 1, "Biography": 1, "Chinese history": 1, "1930s China": 1, "Chinese American community": 3, "Chinese language periodicals": 1, "Periodicals": 2, "Chinese language press": 1, "Newspapers": 1}, "unique_subjects": "{'Chinese history', 'Chinese language periodicals', '1930s China', 'Periodicals', 'Newspapers', 'Memorial volume', 'Biography', 'Chinese American community', 'Chinese language press'}", "items_with_subjects": 4, "common_subjects": [["Chinese American community", 3], ["Periodicals", 2], ["Memorial volume", 1], ["Biography", 1], ["Chinese history", 1]], "subject_coherence": 1.6111111111111112}, "provenance": {"collection_provenance": "Extracted from 4 images using marcsnarc", "item_provenances": {}, "consistency_score": 1.0, "has_provenance": true}, "identifiers": {"items_with_isbn": 0, "items_with_issn": 0, "items_with_oclc": 0, "items_with_lccn": 0, "identifier_coverage": 0.0}, "physical_characteristics": {"extent_variety": 4, "dimension_variety": 2, "physical_coherence": 0.25}, "format_diversity": 3, "creator_diversity": 1, "has_books_serials": true, "shared_provenance": true, "temporal_coherence": 1.0, "workflow_type": "collection_images_to_marc", "collection_name": "CS-test", "processing_timestamp": "2025-12-23T13:45:15.039424", "total_records": 1, "approach": "collection"}, "batch_analysis": {"collection_name": "CS-test", "total_images": 4, "successful_analyses": 4, "failed_analyses": 0, "individual_results": [{"image_path": "examples/Chinese Serials/PXL_20251212_164911546.jpg", "extracted_data": {"title": "Mu Xiansheng jinian zhuanji", "creator": {"name": "Uncertain - appears to be a memorial volume for Mr. Mu (Mu Xiansheng)", "type": "personal", "source": "claude_analysis", "romanization": "Mu Xiansheng"}, "publication_place": "Shanghai (mentioned in text)", "publication_date": "1939 (mentioned in visible text as October 13, 1939)", "normalized_date": {"normalized": "1939", "end_date": null, "circa": false, "uncertain": false, "original": "1939 (mentioned in visible text as October 13, 1939)"}, "format": "book", "extent": "Single volume visible", "dimensions": "Approximately standard book size, exact dimensions not measurable", "language": "chi", "original_script_title": "Chinese characters (traditional)", "other_identifiers": "P.3 marked on label card", "subjects": [{"heading": "Memorial volume", "type": "topical", "source": "claude_analysis"}, {"heading": "Biography", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese history", "type": "topical", "source": "claude_analysis"}, {"heading": "1930s China", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Book is in severely deteriorated condition with dark green/black cloth binding", "source": "image_analysis"}, {"text": "Red/maroon colored boards with significant paint or coating loss", "source": "image_analysis"}, {"text": "White peeling and deterioration visible across cover surface", "source": "image_analysis"}, {"text": "Accompanied by a catalog card with typed bibliographic information", "source": "image_analysis"}, {"text": "Text on card mentions date October 13, 1939 and references Shanghai", "source": "image_analysis"}, {"text": "Text appears to reference events at Zhabei (Èó∏ÂåóÂå∫) in Shanghai", "source": "image_analysis"}, {"text": "Card mentions entries being printed at various locations including Fuzhou", "source": "image_analysis"}, {"text": "The book appears to be a memorial or commemorative publication", "source": "image_analysis"}, {"text": "Condition suggests archival or historical collection item", "source": "image_analysis"}, {"text": "Card notation 'P.3' suggests catalog or collection system", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.5249999999999999, "publication": 0.30333333333333334, "format": 0.26, "language": 0.5850000000000001, "overall": 0.46791666666666665}, "overall_confidence": 0.46791666666666665, "claude_factors": {"text_clarity": "medium", "completeness": "low", "language_certainty": "high"}, "original_text_regions": [{"text": "Partial visible text mentioning: 'October 13, 1939', 'Shanghai', 'Zhabei', references to printing at Fuzhou and other locations, dates from 1936-1939", "language": "English (catalog card)", "location": "catalog card"}, {"text": "Cover text not clearly visible due to deterioration", "language": "Chinese (presumed)", "location": "cover"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Bibliographic information appears incomplete in image", "Contains CJK characters - romanization provided"], "review_required": true, "sequence_number": 1}, {"image_path": "examples/Chinese Serials/PXL_20251212_165136484.jpg", "extracted_data": {"title": "ËèØÁæéÈÄ±Âàä", "format": "newspaper/periodical", "extent": "Single page or sheet", "language": "chi", "original_script_title": "Traditional Chinese characters", "subjects": [{"heading": "Chinese American community", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese language periodicals", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Document appears to be a page from a Chinese-language weekly publication", "source": "image_analysis"}, {"text": "Large red stamp/logo visible on right side containing Chinese characters", "source": "image_analysis"}, {"text": "Text printed in vertical columns reading right to left in traditional format", "source": "image_analysis"}, {"text": "Contains what appears to be news articles and possibly classified advertisements", "source": "image_analysis"}, {"text": "Bottom of page shows 'LUMASUN' text and another publication title", "source": "image_analysis"}, {"text": "Material appears to be historical/archival in nature given paper condition", "source": "image_analysis"}, {"text": "The large red box contains 'ËèØÁæéÈÄ±Âàä' (Hwa Mei Weekly)", "source": "image_analysis"}, {"text": "Table of contents or index visible in left column", "source": "image_analysis"}, {"text": "Document shows signs of age with yellowed paper", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.0, "format": 0.26, "language": 0.5850000000000001, "overall": 0.326}, "overall_confidence": 0.326, "claude_factors": {"text_clarity": "medium", "completeness": "low", "language_certainty": "high"}, "original_text_regions": [{"text": "ËèØÁæéÈÄ±Âàä", "language": "Chinese (Traditional)", "location": "cover/masthead - large red box on right side"}, {"text": "LUMASUN", "language": "English", "location": "bottom edge"}, {"text": "‰ø°Â†±Êñ∞Ê∞ëÊ®Ç", "language": "Chinese (Traditional)", "location": "bottom edge"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Bibliographic information appears incomplete in image", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 2}, {"image_path": "examples/Chinese Serials/PXL_20251212_165121702.jpg", "extracted_data": {"title": "ËèØÁæéÈÄ±Âàä", "publication_place": "Pittsburgh, Ohio", "format": "newspaper/periodical", "extent": "Single issue/page", "dimensions": "Standard newspaper format", "language": "chi", "original_script_title": "Traditional Chinese characters", "subjects": [{"heading": "Chinese American community", "type": "topical", "source": "claude_analysis"}, {"heading": "Periodicals", "type": "topical", "source": "claude_analysis"}, {"heading": "Chinese language press", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "Document appears to be a Chinese-language weekly publication", "source": "image_analysis"}, {"text": "Title 'ËèØÁæéÈÄ±Âàä' appears in large red characters within a bordered frame", "source": "image_analysis"}, {"text": "Text 'HWA MEI WEEKLY' appears in English romanization", "source": "image_analysis"}, {"text": "Publication information shows 'Pittsburgh, Ohio' in English", "source": "image_analysis"}, {"text": "Contains dense columns of traditional Chinese text", "source": "image_analysis"}, {"text": "Document appears aged with some discoloration", "source": "image_analysis"}, {"text": "Multiple columns of Chinese text visible", "source": "image_analysis"}, {"text": "Some English text visible in header area", "source": "image_analysis"}, {"text": "Additional Chinese text visible on what appears to be another publication in background", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.15166666666666667, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.38558333333333333}, "overall_confidence": 0.38558333333333333, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "ËèØÁæéÈÄ±Âàä", "language": "Chinese", "location": "center left - main title"}, {"text": "HWA MEI WEEKLY", "language": "English", "location": "center left - romanized title"}, {"text": "Pittsburgh, Ohio", "language": "English", "location": "upper left margin"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 3}, {"image_path": "examples/Chinese Serials/PXL_20251212_164937723.jpg", "extracted_data": {"title": "ËèØÁæéÈÄ±Â†±", "subtitle": "HWA MEI WEEKLY", "publisher": "ËèØÁæéÈÄ±Â†±Á§æ", "format": "newspaper", "extent": "Single newspaper page", "language": "chi", "original_script_title": "Traditional Chinese characters", "subjects": [{"heading": "Chinese American community", "type": "topical", "source": "claude_analysis"}, {"heading": "Periodicals", "type": "topical", "source": "claude_analysis"}, {"heading": "Newspapers", "type": "topical", "source": "claude_analysis"}], "notes": [{"text": "This appears to be a page from a Chinese-American community newspaper", "source": "image_analysis"}, {"text": "The masthead shows both Chinese characters (ËèØÁæéÈÄ±Â†±) and English romanization (HWA MEI WEEKLY)", "source": "image_analysis"}, {"text": "The page contains multiple columns of traditional Chinese text", "source": "image_analysis"}, {"text": "There appears to be some handwritten text at the top of the page", "source": "image_analysis"}, {"text": "The newspaper appears to be aged with some discoloration", "source": "image_analysis"}, {"text": "Publication includes various articles and what appears to be listings or advertisements", "source": "image_analysis"}, {"text": "Text indicates this is Volume/Issue information visible on left side", "source": "image_analysis"}, {"text": "The format suggests this is from mid-20th century based on typography and paper quality", "source": "image_analysis"}], "extraction_source": "claude_vision", "title_source": "claude_analysis", "creator_source": "claude_analysis", "publication_source": "claude_analysis"}, "confidence_scores": {"title": 0.595, "creator": 0.2, "publication": 0.15166666666666667, "format": 0.45499999999999996, "language": 0.5850000000000001, "overall": 0.38558333333333333}, "overall_confidence": 0.38558333333333333, "claude_factors": {"text_clarity": "medium", "completeness": "medium", "language_certainty": "high"}, "original_text_regions": [{"text": "ËèØÁæéÈÄ±Â†±", "language": "Traditional Chinese", "location": "masthead"}, {"text": "HWA MEI WEEKLY", "language": "English", "location": "masthead"}, {"text": "THE WEEKLY | Published by the Ords | Editorial Office | Of Hwa Mei Weekly | Tel. Jewish People | E. H. Klie, Ed.", "language": "English", "location": "left margin"}], "processing_notes": ["Overall confidence is low - manual review recommended", "Title extraction has low confidence", "Creator/author extraction has low confidence", "Contains CJK characters - romanization provided", "No creator/author information found"], "review_required": true, "sequence_number": 4}], "collection_analysis": {"total_items": 4, "successful_extractions": 4, "common_characteristics": {"primary_language": "chi", "language_distribution": {"chi": 4}, "primary_format": "newspaper/periodical", "format_distribution": {"book": 1, "newspaper/periodical": 2, "newspaper": 1}, "publishers": {"ËèØÁæéÈÄ±Â†±Á§æ": 1}}, "quality_assessment": {"average_confidence": 0.39127083333333335, "high_confidence_items": 0, "low_confidence_items": 4, "confidence_range": [0.326, 0.46791666666666665]}, "recommendations": ["More than 30% of items have low confidence - consider manual review", "4 items contain CJK characters - verify romanization"]}, "batch_confidence": 0.39127083333333335, "processing_timestamp": "2025-12-23T13:45:13.740111"}, "individual_extractions": [{"image_path": "examples/Chinese Serials/PXL_20251212_164911546.jpg", "extraction_confidence": 0.46791666666666665, "extracted_fields": ["title", "creator", "publication_place", "publication_date", "normalized_date", "format", "extent", "dimensions", "language", "original_script_title", "other_identifiers", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Chinese Serials/PXL_20251212_165136484.jpg", "extraction_confidence": 0.326, "extracted_fields": ["title", "format", "extent", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Chinese Serials/PXL_20251212_165121702.jpg", "extraction_confidence": 0.38558333333333333, "extracted_fields": ["title", "publication_place", "format", "extent", "dimensions", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}, {"image_path": "examples/Chinese Serials/PXL_20251212_164937723.jpg", "extraction_confidence": 0.38558333333333333, "extracted_fields": ["title", "subtitle", "publisher", "format", "extent", "language", "original_script_title", "subjects", "notes", "extraction_source", "title_source", "creator_source", "publication_source", "source_image", "extraction_confidence", "sequence_number"]}], "external_api_results": [{"worldcat": [], "loc": [{"type": "subject_authority", "term": "Chinese American community", "valid": false}, {"type": "subject_authority", "term": "Periodicals", "valid": false}], "alma": ["<Element '{http://www.loc.gov/MARC21/slim}record' at 0x7fabdf2143b0>"], "best_match": {"source": "alma", "record": "<Element '{http://www.loc.gov/MARC21/slim}record' at 0x7fabdf2143b0>"}}]};
        const metadataData = {"workflow_type": "collection_images_to_marc", "collection_name": "CS-test", "processing_result": {"approach": "collection", "records_generated": 1, "review_required": true, "groupings": {"approach": "collection", "total_items": 4, "groups": [{"type": "collection", "items": ["Mu Xiansheng jinian zhuanji", "ËèØÁæéÈÄ±Âàä", "ËèØÁæéÈÄ±Âàä", "ËèØÁæéÈÄ±Â†±"], "record_type": "collection"}]}}, "collection_data": {"total_items": 4, "source_images": ["examples/Chinese Serials/PXL_20251212_164911546.jpg", "examples/Chinese Serials/PXL_20251212_165136484.jpg", "examples/Chinese Serials/PXL_20251212_165121702.jpg", "examples/Chinese Serials/PXL_20251212_164937723.jpg"], "provenance": "Extracted from 4 images using marcsnarc"}, "batch_analysis_summary": {"total_images": 4, "successful_analyses": 4, "batch_confidence": 0.39127083333333335}, "processing_timestamp": "2025-12-23T13:45:15.039457"};
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize images array from gallery
            const thumbnails = document.querySelectorAll('.thumbnail');
            currentImages = Array.from(thumbnails).map(img => ({
                src: img.src,
                alt: img.alt
            }));
            
            // Initialize JSON trees
            if (analysisData && Object.keys(analysisData).length > 0) {
                renderJsonTree('analysis-tree', analysisData);
            }
            if (metadataData && Object.keys(metadataData).length > 0) {
                renderJsonTree('metadata-tree', metadataData);
            }
        });
        
        // Modal functions
        function openModal(index) {
            currentImageIndex = index;
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const counter = document.getElementById('modalCounter');
            
            if (currentImages[index]) {
                modalImage.src = currentImages[index].src;
                modalImage.alt = currentImages[index].alt;
                counter.textContent = `${index + 1} of ${currentImages.length}`;
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + currentImages.length) % currentImages.length;
            openModal(currentImageIndex);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') closeModal();
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
            }
        });
        
        // Close modal on background click
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // JSON Tree rendering functions
        function renderJsonTree(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container || !data) return;
            
            container.innerHTML = '';
            const tree = createTreeElement(data, '', 0);
            container.appendChild(tree);
        }
        
        function createTreeElement(value, key, level) {
            const wrapper = document.createElement('div');
            wrapper.style.marginLeft = `${level * 20}px`;
            wrapper.style.marginBottom = '3px';
            
            if (value && typeof value === 'object' && !Array.isArray(value)) {
                // Object
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                Object.entries(value).forEach(([childKey, childValue]) => {
                    children.appendChild(createTreeElement(childValue, childKey, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìÅ ${key} {${Object.keys(value).length}}</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìÇ ${key} {${Object.keys(value).length}}</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else if (Array.isArray(value)) {
                // Array
                const keyElement = document.createElement('div');
                keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                keyElement.style.userSelect = 'none';
                
                const children = document.createElement('div');
                children.style.display = 'none';
                children.style.borderLeft = '2px solid #e2e8f0';
                children.style.marginLeft = '15px';
                children.style.paddingLeft = '10px';
                
                value.forEach((item, index) => {
                    children.appendChild(createTreeElement(item, `[${index}]`, 0));
                });
                
                keyElement.addEventListener('click', function() {
                    const isExpanded = children.style.display !== 'none';
                    if (isExpanded) {
                        children.style.display = 'none';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñ∂ üìö ${key} [${value.length}]</span>`;
                    } else {
                        children.style.display = 'block';
                        keyElement.innerHTML = `<span style="cursor: pointer; color: #2d3748; font-weight: 600;">‚ñº üìñ ${key} [${value.length}]</span>`;
                    }
                });
                
                wrapper.appendChild(keyElement);
                wrapper.appendChild(children);
            } else {
                // Primitive value
                const element = document.createElement('div');
                const valueStr = value === null ? 'null' : String(value);
                const valueType = typeof value;
                let color = '#4a5568';
                let icon = 'üìÑ';
                
                if (valueType === 'string') { color = '#38a169'; icon = 'üìù'; }
                else if (valueType === 'number') { color = '#d69e2e'; icon = 'üî¢'; }
                else if (valueType === 'boolean') { color = '#9f7aea'; icon = '‚úÖ'; }
                else if (value === null) { color = '#a0aec0'; icon = '‚ùå'; }
                
                element.innerHTML = `<span style="color: #2d3748; font-weight: 600;">${icon} ${key}:</span> <span style="color: ${color};">${valueType === 'string' ? '"' + valueStr + '"' : valueStr}</span>`;
                wrapper.appendChild(element);
            }
            
            return wrapper;
        }
        
        function expandAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñ∂')) {
                    span.parentElement.click();
                }
            });
        }
        
        function collapseAllNodes(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Find all clickable tree nodes (divs containing spans with cursor: pointer)
            container.querySelectorAll('span[style*="cursor: pointer"]').forEach(span => {
                if (span.innerHTML.includes('‚ñº')) {
                    span.parentElement.click();
                }
            });
        }
    </script>
</body>
</html>